# ç¬¬17ç« ï¼šä¸å¤‰æ¡ä»¶ï¼ˆInvariantsï¼‰ã£ã¦ãªã«ï¼ŸğŸ”

## ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ ğŸ¯âœ¨

* ã€Œçµ¶å¯¾ã«å®ˆã‚‹ã¹ããƒ«ãƒ¼ãƒ«ï¼ˆä¸å¤‰æ¡ä»¶ï¼‰ã€ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ ğŸ‘€ğŸ“Œ
* ãã®ãƒ«ãƒ¼ãƒ«ã‚’ã€Œæ•£ã‚‰ã•ãšã€ã€Œå£Šã‚Œã«ããã€ç½®ãå ´æ‰€ãŒã‚ã‹ã‚‹ ğŸ§±âœ¨
* é›†ç´„ï¼ˆAggregateï¼‰ã¨ä¸å¤‰æ¡ä»¶ã®é–¢ä¿‚ãŒè…¹è½ã¡ã™ã‚‹ ğŸŒ³ğŸ”’
* â€œè·¨ãæ›´æ–°ã—ãŸããªã‚‹èª˜æƒ‘â€ã‚’ã€ä¸å¤‰æ¡ä»¶ã§è¦‹åˆ†ã‘ã‚‰ã‚Œã‚‹ ğŸ˜ˆâ¡ï¸ğŸ™…â€â™€ï¸

---

## 1. ä¸å¤‰æ¡ä»¶ã£ã¦ãªã«ï¼ŸğŸ¤”ğŸ”

![ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã‚‹ç›¾](./picture/ab_tcb_cs_study_017_invariants.png)


ä¸å¤‰æ¡ä»¶ï¼ˆInvariantï¼‰ã¯ã€ã‹ã‚“ãŸã‚“ã«è¨€ã†ã¨ **ã€Œã©ã‚“ãªã¨ãã‚‚å®ˆã‚‰ã‚Œã¦ãªã„ã¨å›°ã‚‹ãƒ«ãƒ¼ãƒ«ã€** ã ã‚ˆ âœ…ğŸ’¡
ã¤ã¾ã‚Š **ãã®ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆæ¥­å‹™ï¼‰ã«ã¨ã£ã¦â€œå£Šã‚ŒãŸçŠ¶æ…‹â€ã‚’ä½œã‚‰ãªã„ãŸã‚ã®ç´„æŸ** ğŸŒ¸

ãŸã¨ãˆã°ã‚«ãƒ•ã‚§æ³¨æ–‡ãªã‚‰â€¦â˜•ï¸ğŸ§¾

* ã€Œæ³¨æ–‡ãŒç¢ºå®šã—ãŸã‚‰ã€æ˜ç´°ã¯è¿½åŠ ã§ããªã„ã€ğŸ§¾ğŸš«
* ã€Œæ˜ç´°ãŒ0ä»¶ã®æ³¨æ–‡ã¯â€œç¢ºå®šâ€ã§ããªã„ã€ğŸ“­ğŸš«
* ã€Œåˆè¨ˆé‡‘é¡ã¯0å††ä»¥ä¸Šã€ğŸ’´âœ…ï¼ˆãƒã‚¤ãƒŠã‚¹æ³¨æ–‡ã¯å¤‰ï¼ï¼‰

ã“ã†ã„ã† **â€œå®ˆã‚‰ã‚Œã¦ãªã„ã¨äº‹æ•…ã‚‹â€ã‚„ã¤** ãŒä¸å¤‰æ¡ä»¶ã ã‚ˆ ğŸš‘ğŸ’¥

---

## 2. ãªã‚“ã§ä¸å¤‰æ¡ä»¶ãŒãã‚“ãªã«å¤§äº‹ï¼ŸğŸ›¡ï¸âœ¨

ä¸å¤‰æ¡ä»¶ãŒå¼±ã„ã¨ã€ã“ã†ãªã‚‹ã‚ˆğŸ‘‡ğŸ˜µ

* UIã®ãƒã‚§ãƒƒã‚¯ã¯é€šã£ãŸã®ã«ã€åˆ¥ãƒ«ãƒ¼ãƒˆï¼ˆAPI/ãƒãƒƒãƒ/ç®¡ç†ç”»é¢ï¼‰ã‹ã‚‰å£Šã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒå…¥ã‚‹ ğŸ§¨
* ã€ŒãŸã¾ãŸã¾ä»Šã¯å‹•ãã€ã‘ã©ã€å¾Œã§æƒ³åƒã§ããªã„ãƒã‚°ãŒå‡ºã‚‹ ğŸ‘»
* ãƒ‡ãƒ¼ã‚¿ä¿®æ­£åœ°ç„ï¼ˆæ‰‹ä½œæ¥­SQLï¼‰ã«è½ã¡ã‚‹ ğŸ˜­ğŸª¦

DDDã®è€ƒãˆæ–¹ã§ã¯ã€**é›†ç´„ï¼ˆAggregateï¼‰ã®ä¸»ãªè²¬ä»»ã¯â€œä¸å¤‰æ¡ä»¶ã‚’å®ˆã‚‹ã“ã¨â€** ã¨èª¬æ˜ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã‚ˆ ğŸ“ŒğŸŒ³ ([Microsoft Learn][1])

---

## 3. ä¸å¤‰æ¡ä»¶ã¨ã€Œå…¥åŠ›ãƒã‚§ãƒƒã‚¯ã€ã®é•ã„ ğŸ§ğŸ§ 

åˆå¿ƒè€…ãŒæ··ã–ã‚Šã‚„ã™ã„ã®ã§ã€åˆ†ã‘ã‚‹ã­âœ‚ï¸âœ¨

## âœ… ä¸å¤‰æ¡ä»¶ï¼ˆInvariantï¼‰

* **ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ«ãƒ¼ãƒ«**ï¼ˆæ¥­å‹™ä¸Šã®æ­£ã—ã•ï¼‰
* **ã‚¢ãƒ—ãƒªã®ã©ã“ã‹ã‚‰å‘¼ã°ã‚Œã¦ã‚‚å®ˆã‚‰ã‚Œãªã„ã¨ãƒ€ãƒ¡**
* ä¾‹ï¼šã€Œç¢ºå®šå¾Œã¯æ˜ç´°å¤‰æ›´ã§ããªã„ã€ğŸ§¾ğŸš«

## âœ… å…¥åŠ›ãƒã‚§ãƒƒã‚¯ï¼ˆValidationï¼‰

* ç”»é¢ã‚„APIã®éƒ½åˆã®ãƒ«ãƒ¼ãƒ«
* ä¾‹ï¼šã€Œåå‰ã¯30æ–‡å­—ä»¥å†…ã€âœï¸
* ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ç½®ãå ´åˆã‚‚ã‚ã‚‹ã‘ã©ã€é‡è¦åº¦ã¯ä¸å¤‰æ¡ä»¶ã‚ˆã‚Šä¸‹ã«ãªã‚ŠãŒã¡ ğŸŒ¿

---

## 4. â€œä¸å¤‰æ¡ä»¶ã£ã½ã„â€ãƒ«ãƒ¼ãƒ«ã‚’è¦‹ã¤ã‘ã‚‹è³ªå•ãƒ†ãƒ³ãƒ—ãƒ¬ ğŸ•µï¸â€â™€ï¸ğŸ“Œ

æ¬¡ã®è³ªå•ã‚’ã™ã‚‹ã¨ã€ä¸å¤‰æ¡ä»¶ãŒè¦‹ã¤ã‹ã‚Šã‚„ã™ã„ã‚ˆâœ¨

* ã€Œã“ã‚ŒãŒç ´ã‚‰ã‚ŒãŸã‚‰ã€ãŠé‡‘ãƒ»ä¿¡ç”¨ãƒ»åœ¨åº«ãŒå£Šã‚Œã‚‹ï¼Ÿã€ğŸ’°ğŸ“¦ğŸ˜±
* ã€Œå¾Œã‹ã‚‰ç›´ã›ã‚‹ï¼Ÿç›´ã›ãªã„ï¼Ÿã€ğŸ› ï¸
* ã€Œâ€œç¢ºå®š/å®Œäº†â€ã¿ãŸã„ãªå¼·ã„è¨€è‘‰ãŒå‡ºã¦ã‚‹ï¼Ÿã€âœ…
* ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ãã‚‹ï¼Ÿã§ããªã„ï¼Ÿã€ğŸš«
* ã€Œèª°ãŒè¦‹ã¦ã‚‚â€œãã‚Œã¯ãƒ€ãƒ¡ã§ã—ã‚‡â€ã£ã¦ãªã‚‹ï¼Ÿã€ğŸ™…â€â™€ï¸

---

## 5. ä¸å¤‰æ¡ä»¶ã¯â€œæ•£ã‚‰ã•ãªã„â€ã®ãŒã‚³ãƒ„ ğŸ§ ğŸ§·

ä¸å¤‰æ¡ä»¶ãŒæ•£ã‚‹ã¨ã€ã ã‚“ã ã‚“ã“ã†ãªã‚‹ã‚ˆğŸ‘‡ğŸ˜‡

* Aç”»é¢ã§ã¯ç¦æ­¢ã€Bç”»é¢ã§ã¯è¨±å¯ã€ãƒãƒƒãƒã§ã¯ç„¡è¦–â€¦ã¿ãŸã„ãªè¬æŒ™å‹• ğŸ­
* ä¿®æ­£ãŒæ¼ã‚Œã¦äº‹æ•…ã‚‹ ğŸ’¥

ã ã‹ã‚‰åŸºæœ¬ã¯ã“ã†ğŸ‘‡ğŸŒŸ

* **ä¸å¤‰æ¡ä»¶ã¯ã€é›†ç´„ãƒ«ãƒ¼ãƒˆï¼ˆAggregate Rootï¼‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§å®ˆã‚‹** ğŸ‘‘ğŸšª
* ãƒ«ãƒ¼ãƒˆä»¥å¤–ï¼ˆUIã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã€Repositoryã€DBãƒˆãƒªã‚¬ãƒ¼ï¼‰ã«â€œæœ¬å‘½ãƒ«ãƒ¼ãƒ«â€ã‚’ç½®ãã™ããªã„ ğŸ§±

---

## 6. ä¾‹é¡Œï¼šã‚«ãƒ•ã‚§æ³¨æ–‡ã®ä¸å¤‰æ¡ä»¶ã‚’ä½œã‚‹ â˜•ï¸ğŸ§¾âœ¨

ã“ã“ã‹ã‚‰ã€Œæ³¨æ–‡ï¼ˆOrderï¼‰ã€ã‚’é›†ç´„ãƒ«ãƒ¼ãƒˆã¨ã—ã¦è€ƒãˆã‚‹ã‚ˆ ğŸŒ³

## ç™»å ´äººç‰©ï¼ˆã–ã£ãã‚Šï¼‰ğŸ‘€

* `Order`ï¼ˆé›†ç´„ãƒ«ãƒ¼ãƒˆï¼‰ğŸ‘‘
* `OrderItem`ï¼ˆå­ï¼‰ğŸ§¾
* `OrderStatus`ï¼ˆçŠ¶æ…‹ï¼‰ğŸš¦
* `Money`ï¼ˆå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ğŸ’´

## ä¸å¤‰æ¡ä»¶ã®å€™è£œãƒªã‚¹ãƒˆï¼ˆä¾‹ï¼‰ğŸ“Œ

1. **Draftï¼ˆä¸‹æ›¸ãï¼‰ä»¥å¤–ã¯æ˜ç´°è¿½åŠ ã§ããªã„** ğŸ§¾ğŸš«
2. **ç¢ºå®šï¼ˆConfirmedï¼‰ã«ã¯æ˜ç´°ãŒ1ä»¶ä»¥ä¸Šå¿…è¦** ğŸ“­ğŸš«
3. **åŒã˜å•†å“ã‚’2å›å…¥ã‚Œã‚‹ã®ã¯OKï¼ŸNGï¼Ÿï¼ˆæ¥­å‹™æ¬¡ç¬¬ï¼‰** ğŸ§ğŸ¤
4. **åˆè¨ˆé‡‘é¡ã¯å¸¸ã«0ä»¥ä¸Š** ğŸ’´âœ…
5. **ç¢ºå®šå¾Œã¯åˆè¨ˆãŒå‹æ‰‹ã«å¤‰ã‚ã‚‰ãªã„** ğŸ”’

> ã“ã“ã§å¤§äº‹ï¼š**â€œæ¥­å‹™æ¬¡ç¬¬â€ã¯ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã§æ±ºã‚ã‚‹** ğŸ—£ï¸ğŸŒ¸
> ä¸å¤‰æ¡ä»¶ã¯ã€Œä»•æ§˜ã®æ ¸å¿ƒã€ãªã®ã§ã€æ›–æ˜§ã ã¨è¨­è¨ˆãŒæºã‚Œã‚‹ã‚ˆ ğŸ«¨

---

## 7. ä¸å¤‰æ¡ä»¶ã‚’ã‚³ãƒ¼ãƒ‰ã«è½ã¨ã™â€œåŸºæœ¬å½¢â€ ğŸ§±âœ¨

## 7.1 ã€Œå£Šã‚ŒãŸçŠ¶æ…‹ã‚’ä½œã‚Œãªã„ã€å½¢ã«ã™ã‚‹ ğŸ—ï¸ğŸ”’

* ã„ããªã‚Š `new Order()` ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ï¼ˆ= ç„¡åŠ¹çŠ¶æ…‹ãŒä½œã‚‰ã‚Œãªã„ï¼‰ğŸ™…â€â™€ï¸
* `Create()`ï¼ˆãƒ•ã‚¡ã‚¯ãƒˆãƒªï¼‰ã§å¿…ãšåˆæœŸçŠ¶æ…‹ã‚’æ•´ãˆã‚‹ ğŸŒ±
* å¤–ã‹ã‚‰å‹æ‰‹ã«æ›¸ãæ›ãˆã‚‰ã‚Œãªã„ï¼ˆ`public set;` ã‚’é¿ã‘ã‚‹ï¼‰ğŸ”

## 7.2 å¤‰æ›´ã¯ãƒ¡ã‚½ãƒƒãƒ‰ã«é–‰ã˜è¾¼ã‚ã‚‹ âœ‹ğŸ”

* `order.Status = Confirmed;` ã¿ãŸã„ãªç›´æ›¸ãã¯ç¦æ­¢ ğŸ™…â€â™€ï¸
* `order.Confirm()` ã®ä¸­ã§ã€ãƒ«ãƒ¼ãƒ«ã‚’å…¨éƒ¨ãƒã‚§ãƒƒã‚¯ âœ…

---

## 8. C# ã§â€œãã‚Œã£ã½ãâ€æ›¸ãï¼ˆå…¥é–€ï¼‰ğŸ§‘â€ğŸ’»ğŸ°

ã“ã®ç« ã¯ã€Œä¸å¤‰æ¡ä»¶ã®è€ƒãˆæ–¹ã€ãŒä¸»å½¹ã ã‘ã©ã€é›°å›²æ°—ãŒã‚ã‹ã‚‹æœ€å°ã‚³ãƒ¼ãƒ‰ã‚’ç½®ãã‚ˆâœ¨
ï¼ˆæœ¬æ ¼å®Ÿè£…ã¯æ¬¡ç« ã§ã‚„ã‚‹ã‚ˆğŸ› ï¸ï¼‰

```csharp
public enum OrderStatus
{
    Draft,
    Confirmed
}

public sealed class Order
{
    private readonly List<OrderItem> _items = new();

    public Guid Id { get; }
    public OrderStatus Status { get; private set; } = OrderStatus.Draft;

    public IReadOnlyList<OrderItem> Items => _items;

    private Order(Guid id)
    {
        Id = id;
    }

    public static Order Create()
        => new Order(Guid.NewGuid());

    public void AddItem(string name, int unitPrice, int quantity)
    {
        // ä¸å¤‰æ¡ä»¶ï¼šDraftã®é–“ã ã‘è¿½åŠ ã§ãã‚‹
        if (Status != OrderStatus.Draft)
            throw new DomainException("ç¢ºå®šå¾Œã¯æ˜ç´°ã‚’è¿½åŠ ã§ãã¾ã›ã‚“ğŸ§¾ğŸš«");

        // å…¥åŠ›ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ã«ç½®ãã“ã¨ã‚‚ã‚ã‚‹ï¼‰
        if (string.IsNullOrWhiteSpace(name))
            throw new DomainException("å•†å“åãŒç©ºã§ã™ğŸ°ğŸ’¦");

        if (unitPrice <= 0)
            throw new DomainException("å˜ä¾¡ã¯1ä»¥ä¸Šã§ã™ğŸ’´");

        if (quantity <= 0)
            throw new DomainException("æ•°é‡ã¯1ä»¥ä¸Šã§ã™ğŸ§");

        _items.Add(new OrderItem(name, unitPrice, quantity));
    }

    public void Confirm()
    {
        // ä¸å¤‰æ¡ä»¶ï¼šæ˜ç´°0ä»¶ã§ã¯ç¢ºå®šã§ããªã„
        if (_items.Count == 0)
            throw new DomainException("æ˜ç´°ãŒ0ä»¶ãªã®ã§ç¢ºå®šã§ãã¾ã›ã‚“ğŸ“­ğŸš«");

        Status = OrderStatus.Confirmed;
    }
}

public sealed record OrderItem(string Name, int UnitPrice, int Quantity);

public sealed class DomainException : Exception
{
    public DomainException(string message) : base(message) { }
}
```

ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚Œã ã‚ˆğŸ‘‡ğŸŒŸ

* **ä¸å¤‰æ¡ä»¶ã¯â€œçŠ¶æ…‹å¤‰æ›´ã®ç¬é–“â€ã«å¿…ãšãƒã‚§ãƒƒã‚¯** ğŸ”âœ…
* **å¤–ã‹ã‚‰è‡ªç”±ã«ã„ã˜ã‚Œãªã„**ï¼ˆ`private` / `private set`ï¼‰ğŸ”
* **ä¾‹å¤–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤ºã¨ä¸€è‡´ã•ã›ãªã„**ï¼ˆãƒ­ã‚°ç”¨ã¨è¡¨ç¤ºç”¨ã‚’åˆ†ã‘ã‚‹ã®ã¯å¾Œã®ç« ã§ï¼‰ğŸ§¾âœ¨

---

## 9. ã‚¬ãƒ¼ãƒ‰ç¯€ï¼ˆGuard Clausesï¼‰ã§èª­ã¿ã‚„ã™ãã™ã‚‹ ğŸ›¡ï¸ğŸ“–

`if` ãŒå¢—ãˆã‚‹ã¨èª­ã¿ã«ãããªã‚‹ã“ã¨ãŒã‚ã‚‹ã‚ˆã­ğŸ’¦
ãã“ã§ã€Œã‚¬ãƒ¼ãƒ‰ç¯€ã€ï¼ **å…ˆã«ãƒ€ãƒ¡ãªæ¡ä»¶ã‚’å¼¾ã„ã¦ã€æœ¬ç­‹ã‚’ã‚¹ãƒƒã‚­ãƒªã•ã›ã‚‹** âœ¨

.NETç³»ã ã¨ `CommunityToolkit.Diagnostics.Guard` ã¿ãŸã„ãªã‚¬ãƒ¼ãƒ‰APIã‚‚ã‚ã‚‹ã‚ˆï¼ˆæ‰‹æ›¸ãã‚ˆã‚Šç°¡æ½”ã«æ›¸ã‘ã‚‹ç³»ï¼‰ğŸ§°âœ¨ ([Microsoft Learn][2])

ï¼ˆã“ã®æ•™æã§ã¯â€œæ‰‹æ›¸ãifâ€ã§ã‚‚å…¨ç„¶OKğŸ™†â€â™€ï¸ï¼‰

---

## 10. ä¸å¤‰æ¡ä»¶ãŒã€Œé›†ç´„ã®å¢ƒç•Œã€ã‚’æ•™ãˆã¦ãã‚Œã‚‹ ğŸ§ ğŸ§­

ã“ã“è¶…é‡è¦ã ã‚ˆğŸ“Œâœ¨

## âœ… 1ã¤ã®é›†ç´„ã§å®ˆã‚Œã‚‹ä¸å¤‰æ¡ä»¶

* åŒã˜é›†ç´„ã®ä¸­ã®ãƒ‡ãƒ¼ã‚¿ã ã‘ã§åˆ¤æ–­ã§ãã‚‹
* ä¾‹ï¼šã€Œæ³¨æ–‡ç¢ºå®šå¾Œã¯æ˜ç´°è¿½åŠ ç¦æ­¢ã€ğŸ§¾ğŸš«
  â†’ **åŒä¸€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§å®ˆã‚Œã‚‹** ğŸ”’

## âš ï¸ è¤‡æ•°é›†ç´„ã‚’ã¾ãŸãä¸å¤‰æ¡ä»¶ã£ã½ã„ã‚‚ã®

* ä¾‹ï¼šã€Œåœ¨åº«ãŒã‚ã‚‹ãªã‚‰æ³¨æ–‡ç¢ºå®šã§ãã‚‹ã€ğŸ“¦
* ä¾‹ï¼šã€Œä¼šå“¡ãƒ©ãƒ³ã‚¯ã«ã‚ˆã£ã¦å‰²å¼•ãŒâ€¦ã€ğŸ‘‘
  ã“ã‚Œã‚’â€œæ¯å›ã‚¬ãƒã‚¬ãƒã«åŒæœŸâ€ã§å®ˆã‚ã†ã¨ã™ã‚‹ã¨â€¦
* **è·¨ãæ›´æ–°ã®å·¨å¤§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³** ã«å¼•ããšã‚‰ã‚ŒãŒã¡ ğŸ’¥ğŸ˜‡

ã“ã®ã¨ãã¯ã€å¾ŒåŠã®ç« ã§å‡ºã‚‹

* ã€Œæœ€çµ‚çš„æ•´åˆã€â³
* ã€Œã‚¤ãƒ™ãƒ³ãƒˆã€ğŸ“£
* ã€ŒOutboxã€ğŸ“®
  ã¿ãŸã„ãªä¸–ç•Œã«ç¹‹ãŒã£ã¦ã„ãã‚ˆğŸŒˆ

---

## 11. ã‚ã‚ŠãŒã¡äº‹æ•…ãƒ‘ã‚¿ãƒ¼ãƒ³é›† ğŸš«ğŸ˜…

## âŒ public setter ã ã‚‰ã‘

* ã©ã“ã‹ã‚‰ã§ã‚‚å£Šã›ã‚‹ğŸ˜‡
* ãƒ«ãƒ¼ãƒ«ãŒæ•£ã‚‹ğŸŒªï¸

## âŒ ã€ŒIsValid() ã‚’æœ€å¾Œã«å‘¼ã¹ã°ã„ã„ã€

* å‘¼ã³å¿˜ã‚ŒãŸã‚‰çµ‚ã‚ã‚ŠğŸ’¥
* â€œé€”ä¸­çŠ¶æ…‹â€ãŒé•·ãå­˜åœ¨ã™ã‚‹ğŸ‘»

## âŒ DBåˆ¶ç´„ã ã‘ã«é ¼ã‚‹

* UI/ã‚¢ãƒ—ãƒªå´ã¯å£Šã‚ŒãŸçŠ¶æ…‹ã‚’ä½œã£ã¦ã—ã¾ã†
* ä¾‹å¤–ãŒé…ã‚Œã¦å‡ºã¦ãƒ‡ãƒãƒƒã‚°ãŒã—ã‚“ã©ã„ ğŸ˜­

---

## 12. ãƒŸãƒ‹ãƒ¯ãƒ¼ã‚¯âœï¸ğŸ€ï¼ˆä¸å¤‰æ¡ä»¶ã‚’â€œè¨€è‘‰â†’ã‚³ãƒ¼ãƒ‰â€ã«ã™ã‚‹ï¼‰

## ãƒ¯ãƒ¼ã‚¯Aï¼šä¸å¤‰æ¡ä»¶ã‚’10å€‹å‡ºã™ ğŸ§ ğŸ“Œ

ã‚«ãƒ•ã‚§æ³¨æ–‡ã§ã€æ¬¡ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’æƒ³åƒã—ã¦ä¸å¤‰æ¡ä»¶ã‚’æ›¸ãå‡ºã—ã¦ã­âœ¨

* æ˜ç´°è¿½åŠ ğŸ§¾
* ç¢ºå®šâœ…
* ã‚­ãƒ£ãƒ³ã‚»ãƒ«ğŸš«
* å‰²å¼•ğŸŸï¸
* æ”¯æ‰•ã„ğŸ’³

æ›¸ãæ–¹ãƒ†ãƒ³ãƒ—ãƒ¬ğŸ‘‡

* ã€Œã€œã®ã¨ãã€ã€œã—ã¦ã¯ã„ã‘ãªã„ã€ğŸš«
* ã€Œã€œã™ã‚‹ã«ã¯ã€ã€œãŒå¿…è¦ã€âœ…

---

## ãƒ¯ãƒ¼ã‚¯Bï¼šé›†ç´„ãƒ«ãƒ¼ãƒˆã®â€œå¤‰æ›´ãƒ¡ã‚½ãƒƒãƒ‰â€ã‚’3ã¤ä½œã‚‹ ğŸ› ï¸

* `AddItem()`
* `Confirm()`
* `Cancel()`ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯å¦ã¯çŠ¶æ…‹ã§æ±ºã‚ã‚‹ğŸš¦ï¼‰

ãã‚Œãã‚Œã«ä¸å¤‰æ¡ä»¶ã‚’1ã€œ3å€‹ãšã¤åŸ‹ã‚ã‚‹ã‚ˆâœ¨

---

## 13. AIï¼ˆCopilot / Codexï¼‰ã«é ¼ã‚€ã¨ãã®â€œè‰¯ã„èãæ–¹â€ğŸ¤–âœ¨

## 13.1 ä¸å¤‰æ¡ä»¶ã®æŠ½å‡ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ ğŸ§ ğŸ“Œ

```text
ã‚«ãƒ•ã‚§æ³¨æ–‡ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã™ã€‚
Order(é›†ç´„ãƒ«ãƒ¼ãƒˆ)ã®ä¸å¤‰æ¡ä»¶ã‚’10å€‹ã€é‡è¦åº¦é †ã«åˆ—æŒ™ã—ã¦ãã ã•ã„ã€‚
å„ä¸å¤‰æ¡ä»¶ã«ã¤ã„ã¦ã€Œãªãœå¿…è¦ã‹ã€ã€Œã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§å®ˆã‚‹ã¹ãã‹ã€ã‚‚æ›¸ã„ã¦ãã ã•ã„ã€‚
```

## 13.2 ã‚¬ãƒ¼ãƒ‰ç¯€ã®å®Ÿè£…ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ ğŸ›¡ï¸ğŸ§‘â€ğŸ’»

```text
ä»¥ä¸‹ã®ä¸å¤‰æ¡ä»¶ã‚’å¿…ãšå®ˆã‚‹ã‚ˆã†ã«ã€Orderé›†ç´„ãƒ«ãƒ¼ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰(AddItem/Confirm/Cancel)ã‚’C#ã§å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚
æ¡ä»¶é•åæ™‚ã¯DomainExceptionã‚’æŠ•ã’ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æ—¥æœ¬èªã§çŸ­ãã—ã¦ãã ã•ã„ã€‚
ã¾ãŸ public setter ã‚’ä½¿ã‚ãªã„è¨­è¨ˆã«ã—ã¦ãã ã•ã„ã€‚
```

## 13.3 â€œç©´â€ã‚’æ¢ã•ã›ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ ğŸ•µï¸â€â™€ï¸

```text
ã“ã®Orderå®Ÿè£…ã®ã€Œä¸å¤‰æ¡ä»¶ãŒç ´ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ã€ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ã€‚
ç ´ã‚Šæ–¹ã®å…·ä½“ä¾‹ï¼ˆã©ã†ã„ã†å‘¼ã³å‡ºã—é †ã§å£Šã‚Œã‚‹ã‹ï¼‰ã‚‚3ã¤æŒ™ã’ã¦ãã ã•ã„ã€‚
```

---

## ã¾ã¨ã‚ ğŸ€âœ¨

* ä¸å¤‰æ¡ä»¶ï¼**çµ¶å¯¾å®ˆã‚‹æ¥­å‹™ãƒ«ãƒ¼ãƒ«** ğŸ”
* é›†ç´„ãƒ«ãƒ¼ãƒˆãŒ **ä¸å¤‰æ¡ä»¶ã®è²¬ä»»è€…** ã«ãªã£ã¦ã€çŠ¶æ…‹å¤‰æ›´ã®ãŸã³ã«å®ˆã‚‹ ğŸŒ³ğŸ‘‘ ([Microsoft Learn][1])
* å®ˆã‚‹å ´æ‰€ã‚’æ•£ã‚‰ã•ãªã„ã®ãŒå‹ã¡ç­‹ ğŸ§±
* â€œè·¨ãä¸å¤‰æ¡ä»¶â€ãŒå‡ºã¦ããŸã‚‰ã€å¢ƒç•Œã®è¦‹ç›´ã—ã‚µã‚¤ãƒ³ã«ãªã‚Šã‚„ã™ã„ ğŸš¦

æ¬¡ã®ç« ã§ã¯ã€ã“ã®ä¸å¤‰æ¡ä»¶ã‚’ **C#ã®ä½œã‚Šï¼ˆç”Ÿæˆãƒ»ã‚¬ãƒ¼ãƒ‰ç¯€ï¼‰** ã§ã€Œå£Šã‚Œã«ãã„å½¢ã€ã«ã—ã¦ã„ãã‚ˆğŸ› ï¸âœ¨

[1]: https://learn.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/domain-model-layer-validations?utm_source=chatgpt.com "Designing validations in the domain model layer - .NET"
[2]: https://learn.microsoft.com/en-us/dotnet/communitytoolkit/diagnostics/guard?utm_source=chatgpt.com "Guard - Community Toolkits for .NET"
