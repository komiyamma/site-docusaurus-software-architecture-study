# ç¬¬14ç«  ä¾‹å¤–ã‹Resultã‹ï¼šPostã¨ã‚»ãƒƒãƒˆã§è€ƒãˆã‚‹ğŸ­âš–ï¸

## 14.1 ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ğŸ¯âœ¨

ã“ã®ç« ã‚’èª­ã¿çµ‚ã‚ã‚‹ã¨ã€ã“ã‚“ãªåˆ¤æ–­ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ğŸ˜ŠğŸŒ¸

* ã€Œã“ã“ã¯ **ä¾‹å¤–**ï¼ˆthrowï¼‰ã§æ­¢ã‚ã‚‹ã¹ãï¼Ÿã€ãã‚Œã¨ã‚‚ã€Œ**Result**ã§è¿”ã™ã¹ãï¼Ÿã€ã‚’è¿·ã‚ãšé¸ã¹ã‚‹ğŸ§ âœ¨
* Postï¼ˆäº‹å¾Œæ¡ä»¶ï¼‰ã¨ã‚»ãƒƒãƒˆã§ã€ã€ŒæˆåŠŸã—ãŸã‚‰ä½•ã‚’ä¿è¨¼ã™ã‚‹ï¼Ÿã€ã€Œå¤±æ•—ã—ãŸã‚‰ä½•ã‚’ä¿è¨¼ã™ã‚‹ï¼Ÿã€ã‚’è¨€è‘‰ã¨ã‚³ãƒ¼ãƒ‰ã§æ›¸ã‘ã‚‹ğŸ“âœ…
* ä¾‹å¤–ç‰ˆ / Resultç‰ˆã‚’åŒã˜é¡Œæã§ä½œã£ã¦ã€èª­ã¿ã‚„ã™ã•ãƒ»ä½¿ã„ã‚„ã™ã•ã‚’æ¯”è¼ƒã§ãã‚‹ğŸ”ğŸ’¡

---

## 14.2 ã¾ãšè¶…é‡è¦ï¼šå¤±æ•—ã«ã¯2ç¨®é¡ã‚ã‚‹ã‚ˆğŸ­âš–ï¸

![ã‚¨ãƒ©ãƒ¼ã®åˆ†é¡ï¼šä¾‹å¤–ï¼ˆãƒã‚°ï¼‰ã‹Resultï¼ˆä»•æ§˜ï¼‰ã‹](./picture/dbc_cs_study_014_error_classification.png)

ã“ã‚Œã¾ã§ã®ç« ï¼ˆç‰¹ã«ç¬¬4ç« ï¼‰ã§ã‚‚è§¦ã‚Œã¦ããŸã‘ã©ã€
DbCã‚’å®Ÿå‹™ã§ä½¿ã†ä¸Šã§çµ¶å¯¾ã«å¤–ã›ãªã„ã®ãŒ **ã€Œå¤±æ•—ã®ä»•åˆ†ã‘ã€** ã ã‚ˆğŸ§ âœ¨
ã¯ã–ã£ãã‚Š2ã¤ã«åˆ†ã‹ã‚Œã¾ã™ğŸ‘‡âœ¨

### A) å¥‘ç´„é•åï¼ˆãƒã‚°ï¼‰ğŸ§¨ğŸ‘©â€ğŸ’»

* å‘¼ã¶å´/ä½œã‚‹å´ãŒå¥‘ç´„ã‚’ç ´ã£ãŸï¼ˆ= é–‹ç™ºè€…ã®ãƒŸã‚¹ï¼‰
* ä¾‹ï¼š`null`ç¦æ­¢ãªã®ã« `null` ã‚’æ¸¡ã—ãŸã€ç¯„å›²å¤–ã®å€¤ã‚’æ¸¡ã—ãŸã€å†…éƒ¨ä¸å¤‰æ¡ä»¶ã‚’å£Šã—ãŸ

â¡ï¸ ã“ã‚Œã¯ **ä¾‹å¤–ã§è½ã¨ã—ã¦OK**ï¼ˆã‚€ã—ã‚è½ã¨ã—ã¦æ—©ãç›´ã™ï¼‰ğŸ§¯âœ¨
â€» .NETã®è¨­è¨ˆã‚¬ã‚¤ãƒ‰ã§ã‚‚ã€Œé€šå¸¸ã®åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ã«ä¾‹å¤–ã‚’ä½¿ã‚ãªã„ã€æ–¹é‡ãŒæ˜ç¢ºã§ã™ï¼ˆé€†ã«è¨€ã†ã¨ã€ä¾‹å¤–ã¯â€œé€šå¸¸ã˜ã‚ƒãªã„â€æ™‚ã«ä½¿ã†ï¼‰ğŸ“Œ ([Microsoft Learn][1])

### B) ä»•æ§˜ã‚¨ãƒ©ãƒ¼ï¼ˆèµ·ã“ã‚Šã†ã‚‹ãƒ»å›å¾©å¯èƒ½ï¼‰ğŸ™‚ğŸ“©

* ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãƒŸã‚¹ã€åœ¨åº«åˆ‡ã‚Œã€é‡è¤‡ç™»éŒ²ã€æ¨©é™ä¸è¶³â€¦ãªã©
* â€œæƒ³å®šå†…ã®å¤±æ•—â€ã§ã€å‘¼ã¶å´ãŒåˆ†å²ã—ã¦å¯¾å¿œã—ãŸã„

â¡ï¸ ã“ã‚Œã¯ **Resultã§è¿”ã™**ã¨æ‰±ã„ã‚„ã™ã„ã§ã™ğŸâœ¨
ï¼ˆä¾‹å¤–ã§æ¯å›catchã—ã¦åˆ†å²â€¦ã¯ã—ã‚“ã©ã„ï¼†é…ã„ï¼†èª­ã¿ã¥ã‚‰ã„ã«ãªã‚ŠãŒã¡ğŸ¥ºï¼‰

```mermaid
flowchart TD
    Error[å•é¡Œç™ºç”Ÿ!] --> Q{ãã‚Œã¯ãƒã‚°ã‹<br/>æƒ³å®šå†…ã®ä»•æ§˜ã‹?}
    Q -- ãƒã‚° (å¥‘ç´„é•å) --> Exc[ä¾‹å¤– Exception<br/>é–‹ç™ºè€…ãŒç›´ã™ã¹ã]
    Q -- ä»•æ§˜ã‚¨ãƒ©ãƒ¼ (æƒ³å®šå†…) --> Res[Resultå‹<br/>å‘¼ã³å‡ºã—å´ãŒåˆ†å²ã—ã¦å¯¾å¿œ]
    
    style Exc fill:#f8bbd0,stroke:#c2185b
    style Res fill:#fff9c4,stroke:#fbc02d
```

---

## 14.3 ä¾‹å¤–ï¼ˆthrowï¼‰ã‚’é¸ã¶ã®ã¯ã©ã‚“ãªæ™‚ï¼ŸğŸ§¯ğŸ”¥

ä¾‹å¤–ã¯ã€Œ**å‘¼ã³æ–¹ãŒé–“é•ã£ã¦ã‚‹**ã€ã€Œ**ç¶šè¡ŒãŒå±é™º**ã€ã«å‘ã„ã¦ã¾ã™ğŸ’¡

### ä¾‹å¤–ãŒå‘ã„ã¦ã‚‹ã‚±ãƒ¼ã‚¹âœ…

* **å¥‘ç´„é•åï¼ˆãƒã‚°ï¼‰**ï¼šPreã‚’ç ´ã£ãŸã€InvãŒå£Šã‚ŒãŸ
* **å›å¾©ä¸èƒ½**ï¼šãã®å ´ã§ã©ã†ã«ã‚‚ãªã‚‰ãªã„ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ çš„ã«ç¶šã‘ã‚‹ã¨å£Šã‚Œã‚‹ï¼‰
* **æœ¬å½“ã«ç¨€**ï¼šé »ç¹ã«èµ·ãã‚‹å¯èƒ½æ€§ãŒä½ã„ï¼ˆä¾‹å¤–ã¯â€œé€šå¸¸ãƒ«ãƒ¼ãƒˆâ€ã«ã—ãªã„ï¼‰ ([Microsoft Learn][1])

### ä¾‹å¤–ã®è¨­è¨ˆã§å¤§äº‹ãªã“ã¨ğŸ“ŒğŸ’—

* **ä¾‹å¤–ã‚’é€šå¸¸ãƒ•ãƒ­ãƒ¼ã«ã—ãªã„**ï¼ˆåˆ†å²ã—ãŸã„å¤±æ•—ã¯Resultã¸ï¼‰ ([Microsoft Learn][1])
* ä¾‹å¤–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã€Œæœªæ¥ã®è‡ªåˆ†ã¸ã®æ‰‹ç´™ã€ğŸ’Œâœ¨ï¼ˆä½•ãŒãƒ€ãƒ¡ã§ã€ã©ã†ç›´ã™ï¼Ÿï¼‰
* ä¾‹å¤–ãŒèµ·ããŸã‚‰ **çŠ¶æ…‹ã‚’ä¸­é€”åŠç«¯ã«ã—ãªã„**ï¼ˆé€”ä¸­ã§æ›´æ–°ã—ã¦è½ã¡ã‚‹ã®æœ€æ‚ªğŸ˜­ï¼‰ ([Microsoft Learn][2])

---

## 14.4 Resultã‚’é¸ã¶ã®ã¯ã©ã‚“ãªæ™‚ï¼ŸğŸğŸ“©

Resultã¯ã€Œ**æƒ³å®šå†…ã®å¤±æ•—**ã€ã‚’ã€å‘¼ã³å‡ºã—å´ãŒç´ ç›´ã«åˆ†å²ã§ãã‚‹å½¢ã«ã™ã‚‹è€ƒãˆæ–¹ã§ã™ğŸ˜Šâœ¨

### ResultãŒå‘ã„ã¦ã‚‹ã‚±ãƒ¼ã‚¹âœ…

* ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãƒ»æ¥­å‹™ãƒ«ãƒ¼ãƒ«ã§ **ã‚ˆãèµ·ã“ã‚‹å¤±æ•—**ï¼ˆåœ¨åº«åˆ‡ã‚Œã€é‡è¤‡ã€æœŸé™åˆ‡ã‚Œãªã©ï¼‰ğŸ›’â›”
* å‘¼ã³å‡ºã—å´ãŒ **å›å¾©/å†å…¥åŠ›/åˆ¥æ‰‹æ®µ** ã‚’å–ã‚ŠãŸã„ğŸ™‚ğŸ”
* APIå¢ƒç•Œï¼ˆWeb/API/GUIï¼‰ã§ **HTTP 400/409** ãªã©ã«å¤‰æ›ã—ãŸã„ğŸŒğŸ§©

### .NETã®â€œãŠæ‰‹æœ¬â€ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼šTryã€œâœ¨

.NETæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚‚ã€å¤±æ•—ã—ã†ã‚‹å‡¦ç†ã§ **TryParse** ã¿ãŸã„ã« `bool` ã‚’è¿”ã—ã¦ã€å‘¼ã¶å´ãŒåˆ†å²ã§ãã‚‹å½¢ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ğŸ˜Š
ï¼ˆä¾‹å¤–ã‚’é€šå¸¸ãƒ•ãƒ­ãƒ¼ã«ã—ãªã„ä»£è¡¨ä¾‹ğŸ’¡ï¼‰ ([Microsoft Learn][3])

---

## 14.5 è¿·ã£ãŸã‚‰ã“ã‚Œï¼åˆ¤æ–­ãƒãƒ£ãƒ¼ãƒˆğŸ—ºï¸âœ¨

æ¬¡ã®é †ã«è€ƒãˆã‚‹ã¨ã€ã»ã¼è¿·å­ã«ãªã‚Šã¾ã›ã‚“ğŸ˜ŠğŸŒ¸

1. ãã®å¤±æ•—ã¯ **ãƒã‚°ï¼ˆå¥‘ç´„é•åï¼‰**ï¼Ÿ ğŸ‘‰ **ä¾‹å¤–**ğŸ§¯
2. ãã‚Œã¨ã‚‚ **æƒ³å®šå†…ï¼ˆä»•æ§˜ã‚¨ãƒ©ãƒ¼ï¼‰**ï¼Ÿ ğŸ‘‰ **Result**ğŸ
3. å‘¼ã³å‡ºã—å´ãŒåˆ†å²ã—ã¦å›å¾©ã—ãŸã„ï¼Ÿ ğŸ‘‰ **Result**ğŸ
4. æœ¬å½“ã«ç¨€ã§ã€ç¶šè¡ŒãŒå±é™ºï¼Ÿ ğŸ‘‰ **ä¾‹å¤–**ğŸ§¯ ([Microsoft Learn][1])

---

## 14.6 å®Ÿè£…ä¾‹â‘ ï¼šä¾‹å¤–ç‰ˆï¼ˆCreateOrThrowï¼‰ğŸ’¥âœ‹

é¡Œæï¼šãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’â€œæ­£ã—ã„çŠ¶æ…‹ã ã‘â€ã§ä½œã‚ŠãŸã„ğŸ“§âœ¨
æˆåŠŸã—ãŸã‚‰ã€Œå¿…ãšæ­£ã—ã„EmailãŒè¿”ã‚‹ã€ï¼PostãŒè¶…å¼·ã„ğŸ’ªâœ…

```csharp
public sealed record Email
{
    public string Value { get; }

    private Email(string value) => Value = value;

    // âœ… æˆåŠŸã—ãŸã‚‰ã€Œå¿…ãšæœ‰åŠ¹ãªEmailã€ãŒè¿”ã‚‹ï¼ˆPostï¼‰
    // ğŸ’¥ å¤±æ•—ã—ãŸã‚‰ä¾‹å¤–ï¼ˆå¥‘ç´„é•å or ä»•æ§˜ã¨ã—ã¦è¨±ã•ãªã„å…¥åŠ›ï¼‰
    public static Email CreateOrThrow(string value)
    {
        if (value is null) throw new ArgumentNullException(nameof(value));
        if (value.Length == 0) throw new ArgumentException("Email must not be empty.", nameof(value));

        // â€» å³å¯†ãªãƒ¡ãƒ¼ãƒ«æ¤œè¨¼ã¯å¥¥ãŒæ·±ã„ã®ã§ã€ã“ã“ã§ã¯ã€Œæ•™æç”¨ã®ç°¡æ˜“ã€ãƒ«ãƒ¼ãƒ«ã«ã™ã‚‹ã‚ˆğŸ™‚
        if (!value.Contains('@'))
            throw new ArgumentException("Email must contain '@'.", nameof(value));

        return new Email(value);
    }
}
```

### ã“ã®è¨­è¨ˆã®ã„ã„ã¨ã“ã‚ğŸ˜âœ¨

* æˆ»ã‚Šå€¤ãŒã‚·ãƒ³ãƒ—ãƒ«ï¼šå‘¼ã¶å´ã¯ `Email` ã‚’å—ã‘å–ã‚‹ã ã‘ğŸ“¦
* ã€Œä½œã‚ŒãŸï¼æ­£ã—ã„ã€ãªã®ã§ã€ãã®å¾Œã®ã‚³ãƒ¼ãƒ‰ãŒã‚¹ãƒƒã‚­ãƒªğŸ§˜â€â™€ï¸ğŸŒ¸

### æ³¨æ„ç‚¹ğŸ¥ºâš ï¸

* ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‹ã‚‰ç›´æ¥ã“ã‚Œã‚’å‘¼ã¶ã¨ã€ä¾‹å¤–ãŒâ€œé€šå¸¸ãƒ•ãƒ­ãƒ¼â€ã«ãªã‚ŠãŒã¡
  â¡ï¸ UI/APIå¢ƒç•Œã§ã¯ Result ã‚’ä½¿ã†ã‹ã€ä¾‹å¤–ã‚’ã‚­ãƒ£ãƒƒãƒã—ã¦ä¸å¯§ã«å¤‰æ›ã—ã‚ˆã†ğŸšªğŸ§© ([Microsoft Learn][1])

---

## 14.7 å®Ÿè£…ä¾‹â‘¡ï¼šResultç‰ˆï¼ˆTryCreate / Result<T>ï¼‰ğŸâœ¨

ã€Œå…¥åŠ›ãŒé–“é•ã†ã®ã¯æ™®é€šã ã‚ˆã­ğŸ™‚ã€ã¨ã„ã†æ–‡è„ˆã ã¨ã€ResultãŒã‚ã£ã¡ã‚ƒä¾¿åˆ©ã§ã™ğŸ’—

### ã¾ãšã¯ Result å‹ã‚’ç”¨æ„ğŸ€

```csharp
public sealed record Error(string Code, string Message);

public readonly record struct Result<T>(T? Value, Error? Error)
{
    public bool IsSuccess => Error is null;

    public static Result<T> Ok(T value) => new(value, null);

    public static Result<T> Fail(string code, string message)
        => new(default, new Error(code, message));
}
```

### Email.TryCreate ã‚’ä½œã‚‹ğŸ“§ğŸ§ª

```csharp
public sealed record Email
{
    public string Value { get; }

    private Email(string value) => Value = value;

    public static Result<Email> TryCreate(string? value)
    {
        if (value is null)
            return Result<Email>.Fail("EMAIL_NULL", "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæœªå…¥åŠ›ã§ã™ã€‚");

        if (value.Length == 0)
            return Result<Email>.Fail("EMAIL_EMPTY", "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç©ºã§ã™ã€‚");

        if (!value.Contains('@'))
            return Result<Email>.Fail("EMAIL_INVALID", "'@' ã‚’å«ã‚ã¦ãã ã•ã„ã€‚");

        return Result<Email>.Ok(new Email(value));
    }
}
```

### å‘¼ã¶å´ã¯ã“ã†ãªã‚‹ğŸ˜Šâœ¨

```csharp
var result = Email.TryCreate(input);

if (!result.IsSuccess)
{
    Console.WriteLine($"{result.Error!.Code}: {result.Error.Message}");
    return;
}

Email email = result.Value!;
Console.WriteLine($"OK: {email.Value}");

```mermaid
flowchart LR
    Call[ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—] --> Proc{å‡¦ç†å®Ÿè¡Œ}
    Proc -- æˆåŠŸ --> Success["Result (Value)"]
    Proc -- å¤±æ•— --> Failure["Result (Error)"]
    
    Success --> PostS[Post: å€¤ã®ä¿è¨¼âœ…]
    Failure --> PostF[Post: çŠ¶æ…‹ä¸å¤‰ã®ä¿è¨¼ğŸ§Š]
    
    style Success fill:#c8e6c9,stroke:#2e7d32
    style Failure fill:#f8bbd0,stroke:#c2185b
```
```

âœ… åˆ†å²ãŒè‡ªç„¶ï¼
âœ… ä¾‹å¤–ã®catchã«é ¼ã‚‰ãªã„ï¼
ï¼ˆä¾‹å¤–ã‚’é€šå¸¸ãƒ•ãƒ­ãƒ¼ã«ã—ãªã„ã®ãŒè¨­è¨ˆã‚¬ã‚¤ãƒ‰çš„ã«ã‚‚å®‰å¿ƒğŸ’¡ï¼‰ ([Microsoft Learn][1])

---

## 14.8 åŒã˜å‡¦ç†ã‚’2æ–¹å¼ã§æ¯”è¼ƒã—ã¦ã¿ã‚ˆã†ğŸ”ğŸ›’âœ¨

é¡Œæï¼šæ³¨æ–‡ã‚’ç¢ºå®šã™ã‚‹ï¼ˆåœ¨åº«åˆ‡ã‚Œã¯â€œæƒ³å®šå†…â€ï¼‰ğŸ“¦ğŸ›ï¸

### æ–¹å¼Aï¼šä¾‹å¤–ä¸­å¿ƒï¼ˆã¤ã‚‰ããªã‚ŠãŒã¡ï¼‰ğŸ¥º

* åœ¨åº«åˆ‡ã‚Œã®ãŸã³ã«ä¾‹å¤– â†’ catchã§åˆ†å²
* é »ç¹ã«èµ·ãã†ã‚‹å¤±æ•—ãŒä¾‹å¤–ã«ãªã‚‹ã¨ã€ã‚³ãƒ¼ãƒ‰ãŒèª­ã¿ã«ãã„ï¼†è¨­è¨ˆã‚¬ã‚¤ãƒ‰ã¨ã‚‚ç›¸æ€§æ‚ªã„ğŸ’¦ ([Microsoft Learn][1])

### æ–¹å¼Bï¼šResultä¸­å¿ƒï¼ˆãŠã™ã™ã‚ï¼‰ğŸ˜

* åœ¨åº«åˆ‡ã‚Œ â†’ `Fail("OUT_OF_STOCK", "...")`
* å‘¼ã³å‡ºã—å´ã¯ `switch` / `if` ã§åˆ†å²ã—ã‚„ã™ã„ğŸâœ¨

ä¾‹ï¼ˆResultä¸­å¿ƒã®ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰ğŸ‘‡

```csharp
public sealed record OrderId(Guid Value);

public static class OrderErrors
{
    public const string OutOfStock = "OUT_OF_STOCK";
    public const string PaymentDeclined = "PAYMENT_DECLINED";
}

public sealed class OrderService
{
    // âœ… æˆåŠŸã—ãŸã‚‰ã€Œæ³¨æ–‡ãŒç¢ºå®šã—ã¦ OrderId ãŒè¿”ã‚‹ã€ï¼Post
    // âœ… å¤±æ•—ã—ãŸã‚‰ã€Œç†ç”±ã‚³ãƒ¼ãƒ‰ä»˜ãã§è¿”ã‚‹ã€ï¼Post
    public Result<OrderId> PlaceOrder(int productId, int quantity)
    {
        // å¥‘ç´„é•åï¼ˆãƒã‚°ï¼‰ã£ã½ã„ã‚‚ã®ã¯ä¾‹å¤–ã§ã‚‚OKï¼ˆquantity<=0 ãªã©ï¼‰
        if (quantity <= 0) throw new ArgumentOutOfRangeException(nameof(quantity));

        // æƒ³å®šå†…ã®å¤±æ•—ã¯ Result
        if (!HasStock(productId, quantity))
            return Result<OrderId>.Fail(OrderErrors.OutOfStock, "åœ¨åº«ãŒè¶³ã‚Šã¾ã›ã‚“ã€‚æ•°é‡ã‚’æ¸›ã‚‰ã—ã¦ã­ğŸ¥º");

        if (!CanPay())
            return Result<OrderId>.Fail(OrderErrors.PaymentDeclined, "ãŠæ”¯æ‰•ã„ãŒé€šã‚Šã¾ã›ã‚“ã§ã—ãŸğŸ’³ğŸ’¦");

        // ã“ã“ã¾ã§æ¥ãŸã‚‰æˆåŠŸï¼ğŸ‰
        var id = new OrderId(Guid.NewGuid());
        CommitOrder(id);
        return Result<OrderId>.Ok(id);
    }

    private bool HasStock(int productId, int quantity) => true;
    private bool CanPay() => true;
    private void CommitOrder(OrderId id) { /* DBä¿å­˜ãªã© */ }
}
```

---

## 14.9 Postconditionsã‚’â€œæˆåŠŸ/å¤±æ•—â€ã§ã¡ã‚ƒã‚“ã¨æ›¸ãã‚³ãƒ„ğŸ§·âœ…âœ¨

ä¾‹å¤–ã§ã‚‚Resultã§ã‚‚ã€Postã¯ **ã€Œæˆ»ã‚Šæ–¹ã”ã¨ã€** ã«æ›¸ã‘ã¾ã™ğŸ˜Š

### âœ… æˆåŠŸã—ãŸã¨ãã®Postï¼ˆå¼·ãæ›¸ã‘ã‚‹ï¼ï¼‰

* `Result.IsSuccess == true` ã®ã¨ã

  * `Value != null`ï¼ˆå‚ç…§å‹ã®å ´åˆï¼‰
  * å€¤ã®ç¯„å›²ã‚„æ•´åˆæ€§ãŒæˆç«‹ã—ã¦ã„ã‚‹
  * çŠ¶æ…‹æ›´æ–°ãŒå®Œäº†ã—ã¦ã„ã‚‹ï¼ˆæ³¨æ–‡ãŒä½œã‚‰ã‚Œã¦ã„ã‚‹ç­‰ï¼‰

### âœ… å¤±æ•—ã—ãŸã¨ãã®Postï¼ˆResultã®å¼·ã¿âœ¨ï¼‰

* `Result.IsSuccess == false` ã®ã¨ã

  * `Error != null`
  * `Error.Code` ã¯æ©Ÿæ¢°çš„ã«åˆ†å²ã§ãã‚‹ï¼ˆè¡¨ç¤ºæ–‡è¨€ã¨åˆ†é›¢ã§ãã‚‹ï¼‰
  * **çŠ¶æ…‹ã¯å¤‰æ›´ã•ã‚Œã¦ã„ãªã„**ï¼ˆè¶…å¤§äº‹ï¼ï¼‰ ([Microsoft Learn][2])

### âœ… ä¾‹å¤–ã§è¿”ã™ã¨ãã®Post

* ä¾‹å¤–ãŒæŠ•ã’ã‚‰ã‚Œã‚‹æ¡ä»¶ã‚’æ˜ç¢ºã«ï¼ˆPre/Invé•åã€å›å¾©ä¸èƒ½ãªã©ï¼‰
* ä¾‹å¤–ç™ºç”Ÿæ™‚ã‚‚çŠ¶æ…‹ã¯å£Šã•ãªã„ï¼ˆãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯/ä¸å¤‰ã‚’å®ˆã‚‹ï¼‰ ([Microsoft Learn][2])

---

## 14.10 å¢ƒç•Œï¼ˆUI/APIï¼‰ã§ã®æ‰±ã„ğŸšªğŸŒâœ¨

å¢ƒç•Œã¯ã€Œå¤–ã‹ã‚‰å¤‰ãªã‚‚ã®ãŒæ¥ã‚‹å ´æ‰€ã€ãªã®ã§ã€ã“ã“ã§æ•´ç†ã™ã‚‹ã¨ã‚¹ãƒƒã‚­ãƒªã—ã¾ã™ğŸ§¼ğŸ«§

* ãƒ‰ãƒ¡ã‚¤ãƒ³å†…éƒ¨ï¼šå¥‘ç´„é•åã¯ä¾‹å¤–ã§è½ã¨ã—ã¦æ—©æœŸç™ºè¦‹ğŸ§¯
* å¢ƒç•Œï¼šä»•æ§˜ã‚¨ãƒ©ãƒ¼ã¯ Result ã§å—ã‘ã¦ã€ç”»é¢/HTTP ã«å¤‰æ›ğŸ“©
* å¢ƒç•Œã§ä¾‹å¤–ãŒå‡ºãŸã‚‰ï¼šãƒ­ã‚°ï¼†æƒ³å®šå¤–ã¨ã—ã¦æ‰±ã†ï¼ˆ500ãªã©ï¼‰ğŸ§¨

ã€Œä¾‹å¤–ã‚’é€šå¸¸ãƒ•ãƒ­ãƒ¼ã«ã—ãªã„ã€æ–¹å‘ã¯ .NET ã®è¨­è¨ˆã‚¬ã‚¤ãƒ‰ã§ã‚‚æ¨å¥¨ã§ã™ğŸ“Œ ([Microsoft Learn][1])

---

## 14.11 ãƒ†ã‚¹ãƒˆã§â€œå¥‘ç´„â€ã‚’å›ºã‚ã‚ˆã†ğŸ§ªğŸ’—

### ä¾‹å¤–ç‰ˆã®ãƒ†ã‚¹ãƒˆï¼ˆxUnitä¾‹ï¼‰âœ¨

```csharp
using Xunit;

public class EmailExceptionTests
{
    [Fact]
    public void CreateOrThrow_AtMissing_Throws()
    {
        Assert.Throws<ArgumentException>(() => Email.CreateOrThrow("abc.example.com"));
    }
}
```

### Resultç‰ˆã®ãƒ†ã‚¹ãƒˆâœ¨

```csharp
using Xunit;

public class EmailResultTests
{
    [Fact]
    public void TryCreate_AtMissing_FailsWithCode()
    {
        var r = Email.TryCreate("abc.example.com");

        Assert.False(r.IsSuccess);
        Assert.Equal("EMAIL_INVALID", r.Error!.Code);
    }

    [Fact]
    public void TryCreate_Valid_Succeeds()
    {
        var r = Email.TryCreate("a@b.com");

        Assert.True(r.IsSuccess);
        Assert.NotNull(r.Value);
    }
}
```

---

## 14.12 Copilot/Codexæ´»ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ğŸ¤–âœ¨

ãã®ã¾ã¾è²¼ã£ã¦ä½¿ãˆã‚‹å½¢ã«ã—ã¦ãŠãã­ğŸ˜ŠğŸŒ¸

* ã€Œã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã® **æˆåŠŸæ™‚Post / å¤±æ•—æ™‚Post** ã‚’ç®‡æ¡æ›¸ãã§ææ¡ˆã—ã¦ã€‚å¤±æ•—ã¯ Result ã§ã€Error.Codeæ¡ˆã‚‚å‡ºã—ã¦ã€ğŸ“âœ¨
* ã€ŒResult<T> ã‚’ä½¿ã£ãŸå®Ÿè£…ã«ã—ã¦ã€‚**å¤±æ•—æ™‚ã¯çŠ¶æ…‹å¤‰æ›´ã—ãªã„**ã“ã¨ã‚’å®ˆã£ã¦ã€ğŸ§±âœ…
* ã€ŒxUnitã§ã€æˆåŠŸ/å¤±æ•—ã®ãƒ†ã‚¹ãƒˆã‚’å„3æœ¬ãšã¤ã€‚å¢ƒç•Œå€¤ã‚‚å…¥ã‚Œã¦ã€ğŸ§ªğŸ¯

ï¼ˆå‡ºã¦ããŸã‚³ãƒ¼ãƒ‰ã¯ã€**å‘½å**ã¨**è²¬å‹™ã®åˆ†é›¢**ã ã‘ã¯äººé–“ãŒæœ€å¾Œã«æ•´ãˆã¦ã­ğŸ˜‰ğŸ’—ï¼‰

---

## 14.13 ãƒŸãƒ‹æ¼”ç¿’ï¼ˆä¾‹å¤–/Resultã®è¨­è¨ˆæ¯”è¼ƒï¼‰ğŸ”âœ¨

### æ¼”ç¿’1ï¼šåˆ†é¡ã‚²ãƒ¼ãƒ ğŸ®ğŸ§ 

æ¬¡ã®å¤±æ•—ã¯ã€Œä¾‹å¤–ã€ï¼Ÿã€ŒResultã€ï¼Ÿç†ç”±ã‚‚ä¸€è¨€ã§âœï¸ğŸ’•

1. `quantity = -1` ãŒæ¸¡ã•ã‚ŒãŸ
2. åœ¨åº«ãŒè¶³ã‚Šãªã„
3. DBæ¥ç¶šãŒåˆ‡ã‚ŒãŸ
4. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã« `@` ãŒãªã„ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ï¼‰

### æ¼”ç¿’2ï¼šåŒã˜ä»•æ§˜ã‚’2æ–¹å¼ã§å®Ÿè£…ğŸ’ªâœ¨

é¡Œæï¼š`Money`ï¼ˆé‡‘é¡ï¼‰ã‚’ä½œã‚‹ğŸ’´

* ãƒ«ãƒ¼ãƒ«ï¼š0ä»¥ä¸Šã€ä¸Šé™100ä¸‡å††ã¾ã§
* ä¾‹å¤–ç‰ˆï¼š`CreateOrThrow(int amount)`
* Resultç‰ˆï¼š`TryCreate(int amount)`ï¼ˆError.Code ã‚’3ç¨®é¡ãã‚‰ã„ç”¨æ„ï¼‰

### æ¼”ç¿’3ï¼šPostã‚’è¨€èªåŒ–ğŸ“ğŸŒ¸

ä½œã£ãŸ `Money` ã«ã¤ã„ã¦ã€

* æˆåŠŸæ™‚ã«ä¿è¨¼ã™ã‚‹ã“ã¨ï¼ˆPostï¼‰
* å¤±æ•—æ™‚ã«ä¿è¨¼ã™ã‚‹ã“ã¨ï¼ˆPostï¼‰
  ã‚’ãã‚Œãã‚Œ3ã¤æ›¸ã„ã¦ã¿ã¦ã­âœ…âœ¨

---

## 14.14 ã¾ã¨ã‚ğŸ€âœ…

* **å¥‘ç´„é•åï¼ˆãƒã‚°ï¼‰** â†’ ä¾‹å¤–ã§è½ã¨ã—ã¦æ—©ãç›´ã™ğŸ§¯ğŸ’¥
* **æƒ³å®šå†…ï¼ˆä»•æ§˜ã‚¨ãƒ©ãƒ¼ï¼‰** â†’ Resultã§è¿”ã—ã¦åˆ†å²ã—ã‚„ã™ãğŸğŸ“©
* Postã¯ã€ŒæˆåŠŸ/å¤±æ•—ã®æˆ»ã‚Šæ–¹ã”ã¨ã€ã«æ›¸ãã¨å¼·ããªã‚‹ğŸ’ªâœ¨
* .NETã®è¨­è¨ˆã‚¬ã‚¤ãƒ‰çš„ã«ã‚‚ã€**ä¾‹å¤–ã‚’é€šå¸¸ãƒ•ãƒ­ãƒ¼ã«ã—ãªã„**æ–¹å‘ãŒå®‰å¿ƒğŸ˜ŠğŸ“Œ ([Microsoft Learn][1])
* ã„ã¾ã®C#ã¯ **C# 14 / .NET 10** ãŒç¾è¡Œï¼ˆLTSï¼‰ãªã®ã§ã€ã“ã®ç« ã®æ›¸ãæ–¹ãŒãã®ã¾ã¾â€œä»Šã®ä¸»æµâ€ã§ä½¿ãˆã‚‹ã‚ˆğŸ“˜âœ¨ ([Microsoft Learn][4])

[1]: https://learn.microsoft.com/en-us/dotnet/standard/design-guidelines/exception-throwing?utm_source=chatgpt.com "Exception Throwing - Framework Design Guidelines"
[2]: https://learn.microsoft.com/en-us/dotnet/standard/exceptions/best-practices-for-exceptions?utm_source=chatgpt.com "Best practices for exceptions - .NET"
[3]: https://learn.microsoft.com/en-us/dotnet/api/system.int32.tryparse?view=net-10.0&utm_source=chatgpt.com "Int32.TryParse Method (System)"
[4]: https://learn.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-14?utm_source=chatgpt.com "What's new in C# 14"
