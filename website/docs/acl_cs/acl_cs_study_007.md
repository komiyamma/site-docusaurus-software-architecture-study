# ç¬¬7ç« ï¼šå¢ƒç•Œã®å¼•ãæ–¹ï¼ˆå†…å´/å¤–å´ï¼‰ã¨ä¾å­˜é–¢ä¿‚ãƒ«ãƒ¼ãƒ«â¬…ï¸ğŸ§­


## 7.1 ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«ğŸ¯âœ¨

ã“ã®ç« ã‚’çµ‚ãˆãŸã‚‰ã€æ¬¡ã®3ã¤ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ğŸ˜ŠğŸ’ª

* ã€Œå†…å´ï¼ˆå®ˆã‚ŠãŸã„æ ¸ï¼‰ã€ã¨ã€Œå¤–å´ï¼ˆå¤‰ã‚ã‚Šã‚„ã™ã„ä¸–ç•Œï¼‰ã€ã‚’ã‚¹ãƒ‘ãƒƒã¨åˆ†ã‘ã‚‰ã‚Œã‚‹ğŸ§ âœ‚ï¸
* **ä¾å­˜ã®å‘ã**ã‚’é–“é•ãˆãªã„ï¼ˆï¼å†…å´ãŒå¤–å´ã‚’çŸ¥ã‚‰ãªã„ï¼‰ãƒ«ãƒ¼ãƒ«ã‚’è¨€ãˆã‚‹ğŸ§±â¡ï¸
* ãƒ«ãƒ¼ãƒ«ã‚’â€œæ°—åˆã„â€ã˜ã‚ƒãªãã¦ **ä»•çµ„ã¿ã§å®ˆã‚‹**ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‚ç…§ï¼‹ãƒ†ã‚¹ãƒˆï¼‰ã¾ã§ã§ãã‚‹ğŸ”’âœ…

---

### 7.2 ã¾ãšã€Œå¢ƒç•Œã€ã£ã¦ãªã«ï¼ŸğŸ§ƒğŸ§±

å¢ƒç•Œï¼ˆBoundaryï¼‰ã¯ã€ã–ã£ãã‚Šè¨€ã†ã¨â€¦

> **ã€Œã“ã“ã‹ã‚‰å†…å´ã¯â€œè‡ªåˆ†ãŸã¡ã®è¨€è‘‰ãƒ»ãƒ«ãƒ¼ãƒ«â€ã§ç”Ÿãã‚‹ï¼ã€ã£ã¦ç·šå¼•ã**ğŸ’ƒğŸ§ 
> **ã€Œå¤–å´ã®éƒ½åˆï¼ˆä»•æ§˜å¤‰æ›´ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ»éšœå®³ï¼‰ã‚’å†…å´ã«æŒã¡è¾¼ã¾ãªã„ï¼ã€ã£ã¦é˜²æ³¢å ¤**ğŸŒŠğŸ§±

ãŸã¨ãˆã°ãƒŸãƒ‹ECãªã‚‰ã“ã‚“ãªæ„Ÿã˜ğŸ‘‡

* å†…å´ï¼ˆå®ˆã‚ŠãŸã„ï¼‰ğŸ›¡ï¸

  * æ³¨æ–‡ã®ãƒ«ãƒ¼ãƒ«ï¼ˆä¾‹ï¼šåˆè¨ˆé‡‘é¡ã¯ãƒã‚¤ãƒŠã‚¹ç¦æ­¢ï¼‰
  * æ”¯æ‰•ã„çŠ¶æ…‹ã®æ‰±ã„ï¼ˆä¾‹ï¼šPaid / Pending / Failedâ€¦ï¼‰
  * é‡‘é¡ `Money` ã‚„ãƒ¡ãƒ¼ãƒ« `Email` ã¿ãŸã„ãªã€Œæ„å‘³ã®ã‚ã‚‹å‹ã€
* å¤–å´ï¼ˆå¤‰ã‚ã‚Šã‚„ã™ã„ï¼‰ğŸŒªï¸

  * æ±ºæ¸ˆAPIï¼ˆçªç„¶ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å½¢ãŒå¤‰ã‚ã‚‹ğŸ˜‡ï¼‰
  * ãƒ¬ã‚¬ã‚·ãƒ¼ä¼šå“¡APIï¼ˆé …ç›®åãŒå¤ã„ãƒ»æ¬ æãŒå¤šã„ğŸ˜‡ï¼‰
  * DB/EF Coreã€HTTPã€JSONã€ã‚¯ãƒ©ã‚¦ãƒ‰è¨­å®šãªã©

---

### 7.3 ä¾å­˜é–¢ä¿‚ãƒ«ãƒ¼ãƒ«ï¼ˆDependency Ruleï¼‰ã£ã¦ã“ã‚Œï¼â¬…ï¸ğŸ§­âœ¨

![å†…å‘ãã®ä¾å­˜é–¢ä¿‚ãƒ«ãƒ¼ãƒ«](./picture/acl_cs_study_007_dependency.png)

ã“ã®æ•™æã§ã®ä¸€ç•ªå¤§äº‹ãªåˆè¨€è‘‰ã¯ã“ã‚Œã§ã™ğŸ‘‡

> **ä¾å­˜ï¼ˆå‚ç…§ï¼‰ã¯ â€œå†…å‘ãâ€ ã«ãã‚ãˆã‚‹**â¬…ï¸ğŸ§²
> **å†…å´ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰ã¯å¤–å´ï¼ˆDB/HTTP/å¤–éƒ¨APIï¼‰ã‚’å‚ç…§ã—ãªã„**ğŸ™…â€â™€ï¸ğŸ§±

ã“ã‚ŒãŒã§ãã‚‹ã¨ä½•ãŒå¬‰ã—ã„ã®ï¼ŸğŸ˜Šâœ¨

* å¤–éƒ¨APIãŒå¤‰ã‚ã£ã¦ã‚‚ã€å†…å´ã®è¨­è¨ˆãŒå£Šã‚Œã«ãã„ğŸ§±âœ¨
* ãƒ†ã‚¹ãƒˆãŒç°¡å˜ã«ãªã‚‹ï¼ˆå¤–éƒ¨ãªã—ã§ã‚‚å†…å´ã‚’æ¤œè¨¼ã§ãã‚‹ï¼‰ğŸ§ªâœ…
* â€œå¤–å´ã®äº‹æƒ…â€ã«å¼•ããšã‚‰ã‚Œã¦ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¨€è‘‰ãŒè…ã‚Šã«ãã„ğŸ§¼

â€»ã“ã®ã€Œå†…å´ãŒå¤–å´ã‚’çŸ¥ã‚‰ãªã„ã€è€ƒãˆæ–¹ã¯ã€Clean Architectureã®è¦ç‚¹ã¨ã—ã¦ã‚‚ã‚ˆãèªã‚‰ã‚Œã¾ã™ã€‚([Microsoft Learn][1])

---

### 7.4 â€œå†…å´/å¤–å´â€ ã®4ãƒ¬ã‚¤ãƒ¤ãƒ¼åœ°å›³ğŸ—ºï¸âœ¨ï¼ˆè¶…ã‚ˆãã‚ã‚‹å½¢ï¼‰

è¿·ã£ãŸã‚‰ã€ã„ã£ãŸã‚“ã“ã®åˆ†ã‘æ–¹ã«å¯„ã›ã‚‹ã¨æ¥½ã§ã™ğŸ˜ŠğŸ€

```mermaid
flowchart TD
    Pres["Presentation (Web/API/UI)"]
    Infra["Infrastructure (DB/å¤–éƒ¨API/ACL)"]
    App["Application (ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹)"]
    Domain["Domain (æ¥­å‹™ãƒ«ãƒ¼ãƒ«ã®æ ¸)"]
    
    subgraph "å¤–å´ ğŸŒªï¸"
        Pres
        Infra
    end
    
    subgraph "å†…å´ ğŸ›¡ï¸"
        App
        Domain
    end

    Pres --> App
    Infra --> App
    Infra --> Domain
    App --> Domain
```

#### ãã‚Œãã‚Œã®å½¹ç›®ï¼ˆè¶…ã–ã£ãã‚Šï¼‰ğŸ™

* **Domainï¼ˆå†…å´ã®ä¸­å¿ƒï¼‰**ğŸ›¡ï¸

  * ãƒ«ãƒ¼ãƒ«ã€Entityã€ValueObjectã€ä¸å¤‰æ¡ä»¶
  * ã€Œæ³¨æ–‡ã¨ã¯ä½•ã‹ã€ã€Œé‡‘é¡ã¨ã¯ä½•ã‹ã€ã¿ãŸã„ãªæ„å‘³ã®ä¸–ç•Œ
* **Applicationï¼ˆå†…å´ã®å®Ÿè¡Œä¿‚ï¼‰**ğŸ®

  * ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼ˆä¾‹ï¼šæ³¨æ–‡ç¢ºå®šã€æ”¯æ‰•ã„é–‹å§‹ï¼‰
  * Domainã‚’ä½¿ã£ã¦â€œæ‰‹é †â€ã‚’çµ„ã¿ç«‹ã¦ã‚‹
* **Infrastructureï¼ˆå¤–å´ã®å®Ÿè£…ï¼‰**ğŸ”Œ

  * DB/HTTP/å¤–éƒ¨API/ãƒ¬ã‚¬ã‚·ãƒ¼çµ±åˆ
  * **ACLï¼ˆè…æ•—é˜²æ­¢å±¤ï¼‰ã¯ã ã„ãŸã„ã“ã“ã«ç½®ã‹ã‚Œã‚‹**ã“ã¨ãŒå¤šã„ã‚ˆğŸ§¼ğŸ§±
* **Presentationï¼ˆå…¥ã‚Šå£ï¼‰**ğŸšª

  * Web APIã€UIã€Controller
  * ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã¦ Application ã‚’å‘¼ã¶

Microsoftã®ã‚¬ã‚¤ãƒ‰ã§ã‚‚ã€Œæ°¸ç¶šåŒ–ãªã©ã®é–¢å¿ƒäº‹ã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å¤–ã«ç½®ãã€è€ƒãˆæ–¹ãŒèª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚([Microsoft Learn][2])

---

### 7.5 ãƒãƒ³ã‚ºã‚ªãƒ³ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¢ƒç•Œã‚’â€œå‚ç…§â€ã§å›ºå®šã—ã‚ˆã†ğŸ§©ğŸ”’

ã“ã“ãŒè¶…é‡è¦ãƒã‚¤ãƒ³ãƒˆï¼
**ãƒ•ã‚©ãƒ«ãƒ€åˆ†ã‘ã ã‘ã ã¨ç ´ã‚‰ã‚Œã‚„ã™ã„**ã®ã§ã€**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‚ç…§ï¼ˆProject Referenceï¼‰**ã§ã‚¬ãƒã‚¬ãƒã«ã—ã¾ã™ğŸ’ªğŸ˜º

#### â‘  ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆï¼ˆä¾‹ï¼‰ğŸ“âœ¨

* `Shop.Domain`
* `Shop.Application`
* `Shop.Infrastructure`
* `Shop.Api`ï¼ˆWeb APIï¼‰
* `Shop.ArchTests`ï¼ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ†ã‚¹ãƒˆç”¨ï¼‰

#### â‘¡ å‚ç…§ãƒ«ãƒ¼ãƒ«ï¼ˆã“ã‚Œã‚’æ­£è§£ã«ã™ã‚‹ï¼‰âœ…

* `Shop.Domain` â†’ ï¼ˆå‚ç…§ãªã—ï¼‰ğŸ§˜â€â™€ï¸âœ¨
* `Shop.Application` â†’ `Shop.Domain` âœ…
* `Shop.Infrastructure` â†’ `Shop.Application`ï¼ˆï¼‹å¿…è¦ãªã‚‰ `Shop.Domain`ï¼‰âœ…
* `Shop.Api` â†’ `Shop.Application`ï¼ˆï¼‹ `Shop.Infrastructure` ã‚’DIç™»éŒ²ã®ãŸã‚ã«ä½¿ã†ã®ã¯OKï¼‰âœ…

```mermaid
flowchart RL
    Api[Shop.Api] --> App[Shop.Application]
    Api --> Infra[Shop.Infrastructure]
    Infra --> App
    Infra --> Domain[Shop.Domain]
    App --> Domain
    
    style Domain fill: #FFE6FF, stroke: #FF66CC
```

ğŸ’¡ãƒã‚¤ãƒ³ãƒˆï¼š**Domain ãŒ Infrastructure ã‚’å‚ç…§ã—ãªã„**ã‚ˆã†ã«ã™ã‚‹ã®ãŒæœ€å„ªå…ˆï¼ğŸ§±â¬…ï¸

#### â‘¢ â€œã“ã‚Œã‚’ã‚„ã‚‹ã¨è…æ•—ã—ã‚„ã™ã„â€NGä¾‹ğŸ™…â€â™€ï¸ğŸ’¥

* Domain ã« `HttpClient` ã‚’ç½®ãğŸŒï¼ˆå¤–éƒ¨I/OãŒæ··ã–ã‚‹ï¼‰
* Domain ãŒ `Infrastructure` ã®ã‚¯ãƒ©ã‚¹ã‚’ new ã™ã‚‹ğŸ”Œï¼ˆä¾å­˜ãŒé€†æµï¼‰
* Application ãŒ EF Core ã® `DbContext` ã«ã¹ã£ãŸã‚ŠğŸ§Ÿâ€â™€ï¸ï¼ˆå¤–å´æŠ€è¡“ãŒå†…å´ã«ä¾µå…¥ï¼‰

---

### 7.6 â€œç¦æ­¢ä¾å­˜ãƒªã‚¹ãƒˆâ€ã‚’ä½œã‚ã†ğŸ“ğŸš«

ã“ã“ã¯ãƒãƒ¼ãƒ ã§æ‰ã‚ã‚„ã™ã„ã®ã§ã€å…ˆã«æ±ºã‚ã‚‹ã¨å¼·ã„ã§ã™ğŸ˜Šâœ¨
ä¾‹ã¨ã—ã¦ã€ã“ã‚“ãªã€Œç¦æ­¢ã€ã‚’ç½®ãã¨è¿·å­ãŒæ¸›ã‚Šã¾ã™ğŸ‘‡

#### Domainï¼ˆçµ¶å¯¾ã«å…¥ã‚Œãªã„ï¼‰ğŸ›¡ï¸ğŸš«

* å¤–éƒ¨APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆHTTPé€šä¿¡ï¼‰ğŸŒğŸš«
* DBã‚¢ã‚¯ã‚»ã‚¹ï¼ˆEF Coreãªã©ï¼‰ğŸ—„ï¸ğŸš«
* JSONã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼ˆå¤–éƒ¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¾å­˜ï¼‰ğŸ“¦ğŸš«
* Infrastructure ã®åå‰ç©ºé–“å‚ç…§ğŸ”ŒğŸš«

#### Applicationï¼ˆãªã‚‹ã¹ãå…¥ã‚Œãªã„ï¼‰ğŸ§ ğŸš«

* å¤–éƒ¨APIã®DTOï¼ˆå¤–ã®å½¢ã‚’æŒã¡è¾¼ã¾ãªã„ï¼‰ğŸ“¦ğŸš«
* DBã®å…·ä½“å®Ÿè£…ï¼ˆRepositoryã®å®Ÿè£…ã¯å¤–å´ã¸ï¼‰ğŸ—„ï¸ğŸš«

#### Infrastructureï¼ˆå¤–å´ãªã®ã§OKï¼‰ğŸ”Œâœ…

* HTTP/DB/ãƒ•ã‚¡ã‚¤ãƒ«/å¤–éƒ¨SDK ãªã©ã€ç¾å®Ÿã®å‡¦ç†ãœã‚“ã¶OKâœ¨
* ãã®ä»£ã‚ã‚Šã€**å†…å´ã®è¨€è‘‰ã«ç¿»è¨³ã—ã¦æ¸¡ã™**ï¼ˆï¼ACLã®ä»•äº‹ï¼‰ğŸ§¼ğŸ§±âœ¨

---

### 7.7 ä»•çµ„ã¿ã§å®ˆã‚‹â‘ ï¼šã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§â€œé€†æµâ€ã‚’æ­¢ã‚ã‚‹ğŸ§±ğŸš§

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‚ç…§ãŒæ­£ã—ã„ã¨ã€**é–“é•ã£ãŸå‚ç…§ã¯ãƒ“ãƒ«ãƒ‰ãŒé€šã‚‰ãªã„**ã®ã§æœ€å¼·ã§ã™ğŸ’ªğŸ˜†

ãŸã¨ãˆã° Domain ã‹ã‚‰ Infrastructure ã®å‹ã‚’ä½¿ãŠã†ã¨ã™ã‚‹ã¨â€¦

* ãã‚‚ãã‚‚å‚ç…§ã§ããªã„ â†’ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã§æ­¢ã¾ã‚‹ğŸ”¥

ã“ã‚ŒãŒã€Œå¢ƒç•Œã‚’å®ˆã‚‹åŸºæœ¬è£…å‚™ã€ã§ã™ğŸ§±âœ¨

---

### 7.8 ä»•çµ„ã¿ã§å®ˆã‚‹â‘¡ï¼šã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ†ã‚¹ãƒˆã§ç›£è¦–ã™ã‚‹ğŸ‘€âœ…

![ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹é˜²è¡›ç·š](./picture/acl_cs_study_007_arch_test_guardrail.png)

```mermaid
flowchart TD
    Code[å®Ÿè£…ã‚³ãƒ¼ãƒ‰] --> Guard["ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ†ã‚¹ãƒˆğŸ›¡ï¸<br/>(NetArchTest)"]
    Guard -->|é•åã‚ã‚Š| Fail[ãƒ“ãƒ«ãƒ‰å¤±æ•—/ãƒ†ã‚¹ãƒˆå¤±æ•—ğŸ”¥]
    Guard -->|ãƒ«ãƒ¼ãƒ«éµå®ˆ| Pass[OK! å®‰å…¨æ€§ç¢ºä¿âœ…]
```

ã€Œå‚ç…§ã¯å®ˆã£ã¦ã‚‹ã®ã«ã€ã†ã£ã‹ã‚Š `System.Net.Http` ã‚’Domainã§ä½¿ã£ã¡ã‚ƒã£ãŸã€ã¿ãŸã„ãªäº‹æ•…ã€èµ·ãã¾ã™ğŸ˜‡ğŸ’¥
ãã“ã§ **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ†ã‚¹ãƒˆ**ã‚’å…¥ã‚Œã‚‹ã¨ã€â€œå¢ƒç•Œé•åâ€ã‚’ãƒ†ã‚¹ãƒˆã§æ¤œçŸ¥ã§ãã¾ã™ğŸ§ªğŸš¨

ã“ã“ã§ä¾¿åˆ©ãªã®ãŒ **NetArchTest**ï¼ˆä¾å­˜ãƒ»å‘½åãƒ»ãƒ¬ã‚¤ãƒ¤ãƒ¼é•åãªã©ã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ã§ã™ğŸ“¦âœ¨([GitHub][3])

#### â‘  `Shop.ArchTests` ã‚’ä½œã£ã¦ NuGet ã‚’è¿½åŠ ğŸ“¦

* `NetArchTest.Rules`
* ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆxUnitãªã©ï¼‰

#### â‘¡ DomainãŒå¤–å´ã«ä¾å­˜ã—ã¦ãªã„ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹ä¾‹âœ…

```csharp
using NetArchTest.Rules;
using Xunit;

namespace Shop.ArchTests;

public sealed class DomainDependencyTests
{
    [Fact]
    public void Domain_Should_Not_Depend_On_Infrastructure()
    {
        // AssemblyMarker ã¯ Shop.Domain å´ã«ç½®ã„ãŸç©ºã‚¯ãƒ©ã‚¹ï¼ˆå¾Œè¿°ï¼‰
        var domainAssembly = typeof(Shop.Domain.AssemblyMarker).Assembly;

        var result = Types.InAssembly(domainAssembly)
            .ShouldNot()
            .HaveDependencyOn("Shop.Infrastructure")
            .GetResult();

        Assert.True(
            result.IsSuccessful,
            "å¢ƒç•Œé•åï¼\n" + string.Join("\n", result.FailingTypeNames)
        );
    }

    [Fact]
    public void Domain_Should_Not_Do_Http()
    {
        var domainAssembly = typeof(Shop.Domain.AssemblyMarker).Assembly;

        var result = Types.InAssembly(domainAssembly)
            .ShouldNot()
            .HaveDependencyOn("System.Net.Http")
            .GetResult();

        Assert.True(
            result.IsSuccessful,
            "Domainã§HTTPä¾å­˜ã—ã¦ã‚‹ã‚ˆï¼\n" + string.Join("\n", result.FailingTypeNames)
        );
    }
}
```

NetArchTest ã‚’ä½¿ã£ãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ†ã‚¹ãƒˆã®è€ƒãˆæ–¹ãƒ»ä¾‹ã¯å®Ÿä¾‹è¨˜äº‹ã§ã‚‚ã‚ˆãç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚([Code Maze][4])

#### â‘¢ Domainå´ã« â€œAssemblyMarkerâ€ ã‚’ç½®ãğŸ§·

```csharp
namespace Shop.Domain;

// ä½•ã‚‚å…¥ã‚Œãªã„â€œç›®å°â€ã‚¯ãƒ©ã‚¹ï¼ˆãƒ†ã‚¹ãƒˆãŒDomainã®Assemblyã‚’æ‹¾ã†ãŸã‚ï¼‰
public sealed class AssemblyMarker { }
```

---

### 7.9 â€œã©ã“ã«ç½®ãã‹è¿·ã†ã‚‚ã®â€ã‚ã‚‹ã‚ã‚‹åˆ¤å®šğŸ”ğŸ˜º

è¿·ã£ãŸã‚‰ã“ã®è³ªå•ã‚’è‡ªåˆ†ã«ã—ã¦ã¿ã¦ã­ğŸ‘‡

#### Q1ï¼šãã‚Œã¯ã€Œæ¥­å‹™ã®æ„å‘³ã€ï¼Ÿãã‚Œã¨ã‚‚ã€ŒæŠ€è¡“ã®éƒ½åˆã€ï¼ŸğŸ§ ğŸ”§

* æ¥­å‹™ã®æ„å‘³ â†’ Domain / Application å¯„ã‚ŠğŸ›¡ï¸
* æŠ€è¡“ã®éƒ½åˆï¼ˆHTTPã€DBã€JSONã€SDKï¼‰ â†’ Infrastructure å¯„ã‚ŠğŸ”Œ

#### Q2ï¼šãã‚Œã€å¤–éƒ¨ãŒå¤‰ã‚ã£ãŸã‚‰ä¸€ç·’ã«å¤‰ã‚ã‚‹ï¼ŸğŸŒªï¸

* å¤‰ã‚ã‚‹ â†’ å¤–å´ï¼ˆInfrastructure/ACLã§éš”é›¢ï¼‰ğŸ§¼ğŸ§±
* å¤‰ã‚ã‚‰ãªã„ï¼ˆãƒ«ãƒ¼ãƒ«ï¼‰â†’ å†…å´ï¼ˆDomainï¼‰ğŸ›¡ï¸âœ¨

---

### 7.10 ãƒŸãƒ‹èª²é¡Œï¼ˆæ‰‹ã‚’å‹•ã‹ã™ã‚„ã¤ï¼‰ğŸ“ğŸ’ªâœ¨

#### èª²é¡ŒAï¼šå¢ƒç•Œå›³ã‚’1æšä½œã‚‹ğŸ§­ğŸ–Šï¸

* Domain / Application / Infrastructure / Presentation ã‚’ç®±ã§æã
* çŸ¢å°ï¼ˆå‚ç…§ï¼‰ã‚’ **å†…å‘ã**ã«ã™ã‚‹â¬…ï¸âœ¨

#### èª²é¡ŒBï¼šã€Œç¦æ­¢ä¾å­˜ãƒªã‚¹ãƒˆã€ã‚’10å€‹æ›¸ãğŸš«ğŸ“

ä¾‹ï¼š

* Domain ã¯ `System.Net.Http` ã‚’ä½¿ã‚ãªã„
* Domain ã¯ `Shop.Infrastructure` ã‚’å‚ç…§ã—ãªã„
* Application ã¯å¤–éƒ¨DTOã‚’å‚ç…§ã—ãªã„
  â€¦ã¿ãŸã„ã«ãƒ«ãƒ¼ãƒ«ã‚’æ–‡ç« ã«ã™ã‚‹âœï¸

#### èª²é¡ŒCï¼šã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ†ã‚¹ãƒˆã‚’1æœ¬é€šã™ğŸ§ªâœ…

* â€œDomainãŒInfrastructureã«ä¾å­˜ã—ãªã„â€ ãƒ†ã‚¹ãƒˆã‚’æˆåŠŸã•ã›ã‚‹ğŸ‰
* ã‚ã–ã¨é•åã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã€ãƒ†ã‚¹ãƒˆãŒè½ã¡ã‚‹ã®ã‚‚ä½“é¨“ã—ã¦ã¿ã‚‹ğŸ˜ˆğŸ’¥

---

### 7.11 AIæ´»ç”¨ï¼ˆCopilot / Codex ã§æ™‚çŸ­ï¼‰ğŸ¤–âš¡

AIã¯ã€Œè¨­è¨ˆåˆ¤æ–­ã®ä»£ã‚ã‚Šã€ã˜ã‚ƒãªãã¦ã€**æ–‡ç« åŒ–ãƒ»ä¸‹æ›¸ããƒ»æ´—ã„å‡ºã—**ãŒå¾—æ„ã§ã™ğŸ˜Šâœ¨

#### â‘  ä¾å­˜ãƒ«ãƒ¼ãƒ«ã‚’â€œãƒãƒ¼ãƒ å‘ã‘æ–‡ç« â€ã«ã™ã‚‹âœï¸ğŸ¤–

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ï¼š

* ã€Œæ¬¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã§ã€ä¾å­˜é–¢ä¿‚ãƒ«ãƒ¼ãƒ«ã‚’çŸ­ã„ç®‡æ¡æ›¸ãã«ã—ã¦ã€‚Domainã‚’æœ€ã‚‚å³ã—ãã—ã¦ã€‚é•åä¾‹ã‚‚3ã¤å…¥ã‚Œã¦ã€‚ã€

#### â‘¡ ç¦æ­¢ä¾å­˜ã®æ´—ã„å‡ºã—ğŸ”ğŸ¤–

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ï¼š

* ã€ŒDomainå±¤ã«å…¥ã‚Œã‚‹ã¨è…æ•—ã—ã‚„ã™ã„ä¾å­˜ï¼ˆHTTP/DB/JSONãªã©ï¼‰ã‚’10å€‹åˆ—æŒ™ã—ã¦ã€ç†ç”±ã‚’1è¡Œãšã¤ã€‚ã€

#### â‘¢ NetArchTest ã®ãƒ†ã‚¹ãƒˆé››å½¢ã‚’ä½œã‚‹ğŸ§ªğŸ¤–

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ï¼š

* ã€ŒNetArchTest.Rules ã§ã€DomainãŒ System.Net.Http ã¨ Infrastructure ã«ä¾å­˜ã—ãªã„ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ xUnit ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã€‚å¤±æ•—å‹åã‚‚å‡ºã—ã¦ã€‚ã€

---

### 7.12 ã¾ã¨ã‚ï¼ˆã“ã®ç« ã§è¦šãˆãŸä¸€è¨€ï¼‰ğŸ§ âœ¨

* **å¢ƒç•Œï¼å†…å´ã‚’å®ˆã‚‹ç·šå¼•ã**ğŸ§±
* **ä¾å­˜ã¯å†…å‘ã**â¬…ï¸ğŸ§²
* **ãƒ«ãƒ¼ãƒ«ã¯â€œä»•çµ„ã¿â€ã§å®ˆã‚‹ï¼ˆå‚ç…§ï¼‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ†ã‚¹ãƒˆï¼‰**ğŸ”’âœ…

ã¡ãªã¿ã«ä»Šã©ãã®C#/.NETã®æœ€æ–°ãƒ©ã‚¤ãƒ³ã§ã¯ã€.NET 10 ãŒLTSã¨ã—ã¦æä¾›ã•ã‚Œã€C# 14 ã¯ .NET 10 ä¸Šã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ï¼ˆVisual Studio 2026 ã‚‚å«ã‚ã¦æ¡ˆå†…ã•ã‚Œã¦ã„ã¾ã™ï¼‰ã€‚([Microsoft for Developers][5])

[1]: https://learn.microsoft.com/en-us/dotnet/architecture/modern-web-apps-azure/common-web-application-architectures?utm_source=chatgpt.com "Common web application architectures - .NET"
[2]: https://learn.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design?utm_source=chatgpt.com "Designing the infrastructure persistence layer - .NET"
[3]: https://github.com/BenMorris/NetArchTest?utm_source=chatgpt.com "BenMorris/NetArchTest: A fluent API for .Net that can ..."
[4]: https://code-maze.com/csharp-architecture-tests-with-netarchtest-rules/?utm_source=chatgpt.com "Architecture Tests in .NET with NetArchTest.Rules"
[5]: https://devblogs.microsoft.com/dotnet/announcing-dotnet-10/?utm_source=chatgpt.com "Announcing .NET 10"
