# ç¬¬23ç« ã€€Inbound Portè¨­è¨ˆâ‘¡ï¼šDTOï¼ˆå…¥åŠ›/å‡ºåŠ›ï¼‰ã‚’ä½œã‚‹ğŸ“¦âœ¨

å‰ã®ç« ã§ã€Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å…¥å£ï¼Inbound Portï¼ˆinterfaceï¼‰ã€ã‚’ç”¨æ„ã—ãŸã‚ˆã­ï¼ŸğŸ˜Š
ã“ã®ç« ã§ã¯ã€ãã®PortãŒå—ã‘å–ã‚‹ **å…¥åŠ›DTO** ã¨ã€è¿”ã™ **å‡ºåŠ›DTO** ã‚’ä½œã£ã¦ã„ãã‚ˆã€œï¼ğŸ§ğŸ’•

â€»ã„ã¾ã®æœ€æ–°ã ã¨ã€C# 14 ãŒ â€œæœ€æ–°ã®C#â€ ã§ .NET 10 ã«å¯¾å¿œã—ã¦ã‚‹ã‚ˆğŸ†•âœ¨ ([Microsoft Learn][1])
ï¼ˆ.NET 10 ã¯ 2025/11/11 ãƒªãƒªãƒ¼ã‚¹ã€2026/01/13 æ™‚ç‚¹ã§ 10.0.2 ãŒæœ€æ–°ãƒ‘ãƒƒãƒã¨ã—ã¦è¼‰ã£ã¦ã‚‹ï¼‰ ([Microsoft Learn][2])

---

## 1) DTOã£ã¦ãªã«ï¼Ÿãªã‚“ã§å¿…è¦ï¼ŸğŸ¤”ğŸ“¦

![DTO Box](../picture/hex_cs_study_023_dto_box.png)

```mermaid
sequenceDiagram
    participant Web as Web (Adapter)
    participant UC as UseCase (Core)
    
    Web->>UC: Input DTO (Command)
    Note right of Web: ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãªå€¤ã®ç®±ğŸ“¦
    UC->>UC: å¤‰æ› & å®Ÿè¡Œ
    UC-->>Web: Output DTO (Result)
    Note left of UC: æ•´å½¢æ¸ˆã¿ã®ãƒ‡ãƒ¼ã‚¿ã®ç®±ğŸ
```

DTOï¼ˆData Transfer Objectï¼‰ã¯ä¸€è¨€ã§ã„ã†ã¨â€¦

* **ã€Œãƒ‡ãƒ¼ã‚¿ã‚’é‹ã¶ãŸã‚ã ã‘ã®å…¥ã‚Œç‰©ã€**ğŸ“¦ğŸšš
* ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæŒ¯ã‚‹èˆã„ï¼‰ã˜ã‚ƒãªãã€**é …ç›®ï¼ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰ä¸­å¿ƒ**âœ¨
* å…¥åŠ›ç”¨ï¼ˆInputï¼‰ã¨å‡ºåŠ›ç”¨ï¼ˆOutputï¼‰ã‚’åˆ†ã‘ã‚‹ã®ãŒåŸºæœ¬ã ã‚ˆğŸ˜Š

### ãªãœDomainå‹ã‚’ãã®ã¾ã¾å¤–ã¸å‡ºã•ãªã„ã®ï¼ŸğŸ™…â€â™€ï¸ğŸ 

ç†ç”±ã¯ã‚ã¡ã‚ƒå¤§äº‹ï¼

* **DomainãŒâ€œå¤–éƒ¨éƒ½åˆâ€ã«æ±šæŸ“ã•ã‚Œã‚‹**ï¼ˆJSONéƒ½åˆã€ç”»é¢éƒ½åˆã€DBéƒ½åˆï¼‰ğŸ§¼ğŸ’¦
* DomainãŒå¤‰ã‚ã‚‹ãŸã³ã«ã€APIã‚„ç”»é¢ã¾ã§é€£é–ã§å£Šã‚Œã‚„ã™ã„ğŸğŸ˜­
* â€œè¦‹ã›ã¡ã‚ƒã„ã‘ãªã„æƒ…å ±â€ãŒæ··ã–ã‚Šã‚„ã™ã„ï¼ˆå†…éƒ¨IDã‚„ç®¡ç†ç”¨ãƒ•ãƒ©ã‚°ç­‰ï¼‰ğŸ”’ğŸ˜‡

ã ã‹ã‚‰ã€**Coreã®å¤–ã¸ã¯DTOã§å‡ºã™**ãŒå®‰å®šï¼ğŸ›¡ï¸âœ¨

---

## 2) Inbound DTOã®è¨­è¨ˆãƒ«ãƒ¼ãƒ«ï¼ˆè¶…é‡è¦ï¼‰âœ…âœ¨

ã“ã“ã€è¨­è¨ˆã®èŠ¯ã ã‚ˆâ¤ï¸

### âœ… Input DTOï¼ˆå…¥åŠ›ï¼‰

* å¤–ã‹ã‚‰æ¥ã‚‹å€¤ã¯ **ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å¯„ã‚Š**ï¼ˆstring/int/decimal ãªã©ï¼‰ã§å—ã‘ã‚‹ğŸ§º
* å—ã‘ãŸå¾Œã€UseCaseå†…éƒ¨ã§ Domain ã® ValueObject ã«å¤‰æ›ã™ã‚‹ğŸ”ğŸ’
* å¿…é ˆãƒ»ä»»æ„ã‚’ãƒãƒƒã‚­ãƒªï¼ˆnullabilityã§è¡¨ç¾ï¼‰ğŸ§ âœ¨

### âœ… Output DTOï¼ˆå‡ºåŠ›ï¼‰

* ç”»é¢ã‚„APIãŒæ¬²ã—ã„å½¢ã« â€œæ•´å½¢ã—ãŸçµæœâ€ ã‚’è¿”ã™ğŸ
* Domainã®Entityã‚’ä¸¸ã”ã¨è¿”ã•ãªã„ï¼ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’çµã‚‹ï¼‰âœ‚ï¸âœ¨
* æ—¥æ™‚ãƒ»é‡‘é¡ãªã©ã‚‚ã€Œè¡¨ç¤ºã—ã‚„ã™ã„å½¢ã€ã§OKï¼ˆãŸã ã—è²¬å‹™ã‚’è€ƒãˆã‚‹ï¼‰ğŸ•’ğŸ’°

---

## 3) ã©ã“ã«DTOã‚’ç½®ãã®ï¼ŸğŸ“ğŸ‘€

ãŠã™ã™ã‚ã¯ã“ã®ã©ã¡ã‚‰ã‹ï¼š

* **Applicationï¼ˆUseCaseå´ï¼‰ã«ç½®ã**ï¼šPortãŒä½¿ã†å‹ã ã‹ã‚‰è‡ªç„¶ğŸ˜Š
* **Portsã¨åŒã˜è¿‘ãã«ç½®ã**ï¼š`Application/Ports` ã¨ã‹ `Application/Dtos` ã¨ã‹ğŸ“¦

> ãƒã‚¤ãƒ³ãƒˆï¼š**Controllerã‚„HTTPã®äº‹æƒ…ï¼ˆå±æ€§ã¨ã‹ï¼‰ã¯Coreå´ã«å…¥ã‚Œãªã„**ğŸš«ğŸŒ
> ï¼ˆå¿…è¦ãªã‚‰ Controller å´ã« â€œAPIç”¨Request/Responseâ€ ã‚’ä½œã£ã¦ã€ãã“ã‹ã‚‰UseCase DTOã¸å¤‰æ›ã™ã‚‹ã®ãŒã‚­ãƒ¬ã‚¤âœ¨ï¼‰

---

## 4) ã‚«ãƒ•ã‚§æ³¨æ–‡ã‚¢ãƒ—ãƒªï¼šDTOã‚’ä½œã£ã¦ã¿ã‚ˆã†â˜•ğŸ§¾âœ¨

ã“ã“ã§ã¯ã€Œæ³¨æ–‡ä½œæˆã€ã‚’ä¾‹ã«ã™ã‚‹ã­ï¼

### æƒ³å®šãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

* æ³¨æ–‡ä½œæˆï¼ˆCreateOrderï¼‰
* å…¥åŠ›ï¼šæ³¨æ–‡è€…å / æ³¨æ–‡æ˜ç´°ï¼ˆå•†å“IDã¨æ•°é‡ï¼‰
* å‡ºåŠ›ï¼šæ³¨æ–‡ID / åˆè¨ˆé‡‘é¡ / ä½œæˆæ—¥æ™‚

---

## 5) DTOã®å®Ÿè£…ä¾‹ï¼ˆC#ï¼‰ğŸ§‘â€ğŸ’»âœ¨

### (1) å…¥åŠ›DTOï¼ˆCommand / Inputï¼‰ğŸ“¥

* â€œå¤–ã‹ã‚‰æ¥ã‚‹å€¤â€ã‚’é‹ã¶ã ã‘ï¼

```csharp
namespace CafeOrder.Core.Application.Dtos;

public sealed record OrderItemInputDto(
    string MenuItemId,
    int Quantity
);

public sealed record CreateOrderInputDto(
    string CustomerName,
    IReadOnlyList<OrderItemInputDto> Items
);
```

ï¼ˆrecord ã¯ã€Œä¸å¤‰ã£ã½ãæ‰±ã„ã‚„ã™ã„DTOã€ã«ç›¸æ€§ã„ã„ã‚ˆğŸ˜ŠğŸ’ï¼‰

### (2) å‡ºåŠ›DTOï¼ˆResult / Outputï¼‰ğŸ“¤

* UI/APIãŒæ¬²ã—ã„çµæœã‚’è¿”ã™ï¼

```csharp
namespace CafeOrder.Core.Application.Dtos;

public sealed record CreateOrderOutputDto(
    Guid OrderId,
    decimal TotalAmount,
    string Currency,
    DateTimeOffset CreatedAt
);
```

---

## 6) Portï¼ˆUseCase interfaceï¼‰ã«DTOã‚’åˆºã™ğŸ§©ğŸ”Œ

å‰ç« ã®Portã‚’ã€DTOä»˜ãã«ã™ã‚‹ã¨ã“ã†ãªã‚‹ã‚ˆï¼

```csharp
using CafeOrder.Core.Application.Dtos;

namespace CafeOrder.Core.Application.Ports.Inbound;

public interface ICreateOrderUseCase
{
    Task<CreateOrderOutputDto> HandleAsync(CreateOrderInputDto input, CancellationToken ct);
}
```

> ã“ã“ãŒæ°—æŒã¡ã„ã„ã¨ã“ã‚ï¼š
> **å¤–ï¼ˆControllerï¼‰ãŒã“ã®Portã‚’å‘¼ã¹ã°ã€Coreã«æ­£ã—ã„å½¢ã§å±Šã**ğŸšªâœ¨

---

## 7) å¤‰æ›ï¼ˆDTO â†” Domainï¼‰ã¯ã©ã“ã§ã‚„ã‚‹ï¼ŸğŸ”ğŸ§¼

çµè«–ï¼š**Coreã®ä¸­ã§ã‚‚ã€UseCaseå´ã§Domainã¸å¤‰æ›ã™ã‚‹**ã®ãŒåˆå¿ƒè€…ã«å„ªã—ã„ã‚ˆğŸ˜Š
ï¼ˆHTTPç”±æ¥ã®å¤‰æ›ã¯ Controller å´ã«å¯„ã›ã‚‹ã®ãŒå®šçŸ³âœ¨ï¼‰

### ã‚ˆãã‚ã‚‹å¤‰æ›ã®æµã‚Œï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰ğŸ—ºï¸

* Controllerï¼šHTTP Request â†’ï¼ˆå¿…è¦ãªã‚‰ï¼‰UseCase Input DTO
* UseCaseï¼šInput DTO â†’ Domainï¼ˆEntity/VOï¼‰ã¸å¤‰æ›ã—ã¦å®Ÿè¡Œ
* UseCaseï¼šDomainçµæœ â†’ Output DTO ã«æ•´å½¢
* Controllerï¼šOutput DTO â†’ HTTP Response

> ã“ã®ç« ã®åˆè¨€è‘‰ï¼š**ã€Œå¤‰æ›ã§â€œå¤–ã®éƒ½åˆâ€ã‚’æ­¢ã‚ã‚‹ã€**ğŸ›‘âœ¨

---

## 8) ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã©ã“ã§ã‚„ã‚‹ï¼Ÿâœ…ğŸ§¯

ã€Œå…¨éƒ¨Controllerã§ãƒã‚§ãƒƒã‚¯ã™ã¹ãï¼Ÿã€ã£ã¦è¿·ã„ãŒã¡ã ã‘ã©ã€åˆ†ã‘ã‚‹ã¨æ¥½ï¼

### âœ… Controllerå´ã§ã‚„ã‚‹ï¼ˆå½¢ã®ãƒã‚§ãƒƒã‚¯ï¼‰

* null/ç©º
* æ•°å€¤ãŒãƒ‘ãƒ¼ã‚¹ã§ãã‚‹
* é…åˆ—ãŒç©ºã˜ã‚ƒãªã„ ãªã©

### âœ… UseCaseå´ã§ã‚„ã‚‹ï¼ˆæ¥­å‹™ãƒ«ãƒ¼ãƒ«ï¼‰

* æ•°é‡ã¯1ä»¥ä¸Š
* åŒã˜å•†å“ã‚’2å›é ¼ã‚“ã ã‚‰ã¾ã¨ã‚ã‚‹ï¼Ÿ
* å­˜åœ¨ã—ãªã„å•†å“ã¯ãƒ€ãƒ¡ ãªã©

â€œæ¥­å‹™ãƒ«ãƒ¼ãƒ«â€ã¯ **Coreï¼ˆUseCase/Domainï¼‰ã«æ®‹ã™**ã®ãŒå‹ã¡ç­‹ã ã‚ˆğŸ›¡ï¸â¤ï¸

---

## 9) DTOå‘½åã®ãŠã™ã™ã‚ï¼ˆè¿·ã£ãŸã‚‰ã“ã‚Œï¼‰ğŸ§ âœ¨

åˆå¿ƒè€…ã ã¨å‘½åã§æººã‚Œã‚„ã™ã„ã®ã§ã€æœ€åˆã¯å›ºå®šã§OKï¼

* å…¥åŠ›ï¼š`CreateOrderInputDto`ï¼ˆã¾ãŸã¯ `CreateOrderCommand`ï¼‰
* å‡ºåŠ›ï¼š`CreateOrderOutputDto`ï¼ˆã¾ãŸã¯ `CreateOrderResult`ï¼‰
* æ˜ç´°ï¼š`OrderItemInputDto` ã¿ãŸã„ã«å½¹å‰²ãŒåˆ†ã‹ã‚‹åå‰ğŸ“›

> å¤§äº‹ãªã®ã¯ã€Œçµ±ä¸€æ„Ÿã€ã ã‚ˆã€œğŸ˜ŠğŸ§¡

---

## 10) AIï¼ˆCopilot/Codexç­‰ï¼‰ã«é ¼ã‚€ã¨ãã®ã‚³ãƒ„ğŸ¤–ğŸª„

AIã«DTOã‚’ä½œã‚‰ã›ã‚‹ã®ã€ã‚ã¡ã‚ƒç›¸æ€§ã„ã„ï¼
ã§ã‚‚ **å¢ƒç•Œãƒ«ãƒ¼ãƒ«ã ã‘ã¯äººãŒå®ˆã‚‹**ğŸš¦âœ¨

### ä½¿ãˆã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ğŸ’¬

* ã€Œæ³¨æ–‡ä½œæˆã® Input/Output DTO ã‚’ record ã§ä½œã£ã¦ã€‚Domainå‹ã¯ä½¿ã‚ãšã€primitiveä¸­å¿ƒã§ã€
* ã€ŒUseCaseã®Port interfaceã‚’ã€Input DTO ã¨ Output DTO ã‚’ä½¿ã†å½¢ã§ææ¡ˆã—ã¦ã€

### ãŸã ã—æ³¨æ„âš ï¸

* AIã¯æ²¹æ–­ã™ã‚‹ã¨ **Domain Entity ã‚’ãã®ã¾ã¾è¿”ã™**æ¡ˆã‚’å‡ºã—ã¦ãã‚‹ğŸ˜‚
  â†’ ãã®ç¬é–“ã«ã€Œãã‚Œã¯ã‚„ã‚ã‚ˆã£ã‹ğŸ˜Šã€ã£ã¦æ­¢ã‚ã‚‹ï¼ğŸ›‘âœ¨

---

## 11) ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆâœ…âœ…âœ…

ä½œã‚Šçµ‚ãˆãŸã‚‰ã€ã“ã“è¦‹ã¦ã­ï¼

* [ ] Domainã®Entity/VOã‚’ãã®ã¾ã¾å¤–ã¸å‡ºã—ã¦ãªã„ï¼ŸğŸ™…â€â™€ï¸
* [ ] PortãŒå—ã‘å–ã‚‹å‹ãƒ»è¿”ã™å‹ã¯DTOã«ãªã£ã¦ã‚‹ï¼ŸğŸ“¦
* [ ] JSONå±æ€§ã‚„HTTPéƒ½åˆãŒCoreå´ã«å…¥ã£ã¦ãªã„ï¼ŸğŸš«ğŸŒ
* [ ] å¤‰æ›ã®å ´æ‰€ãŒæ±ºã¾ã£ã¦ã‚‹ï¼Ÿï¼ˆå¤–ã®éƒ½åˆãŒCoreã«æ¼ã‚Œã¦ãªã„ï¼Ÿï¼‰ğŸ§¼âœ¨

---

## 12) ãƒŸãƒ‹ç·´ç¿’ğŸ¯â˜•

1. `ListOrdersOutputDto` ã‚’ä½œã£ã¦ã¿ã‚ˆã†ï¼ˆæ³¨æ–‡ä¸€è¦§ç”¨ï¼‰ğŸ“ƒâœ¨
2. `OrderSummaryDto`ï¼ˆæ³¨æ–‡IDã€åˆè¨ˆã€ä½œæˆæ—¥æ™‚ï¼‰ã‚’ä½œã£ã¦ä¸€è¦§ã«ä½¿ã£ã¦ã¿ã‚ˆã†ğŸ§¾
3. å…¥åŠ›DTOã® `Items` ãŒç©ºã®ã¨ãã€ã©ã“ã§å¼¾ãã‹æ±ºã‚ã¦ã¿ã‚ˆã†ï¼ˆControllerï¼ŸUseCaseï¼Ÿï¼‰ğŸ¤”âœ…

---

æ¬¡ã®ç« ã§ã¯ã€ã„ã‚ˆã„ã‚ˆ **Inbound Adapterï¼ˆControllerï¼‰ã‚’â€œè–„ãâ€ä½œã‚‹**ã‚ˆã€œï¼ğŸŒğŸ™‚
DTOãŒã§ããŸã‹ã‚‰ã€Controllerã¯ã‚¹ãƒƒã‚­ãƒªã—ã‚„ã™ããªã‚‹ã¯ãšğŸ˜†âœ¨

[1]: https://learn.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-14?utm_source=chatgpt.com "What's new in C# 14"
[2]: https://learn.microsoft.com/ja-jp/lifecycle/products/microsoft-net-and-net-core?utm_source=chatgpt.com "Microsoft .NET ãŠã‚ˆã³ .NET Core - Microsoft Lifecycle"
